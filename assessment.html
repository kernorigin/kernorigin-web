<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Free Business Assessment | Kernorigin</title>
    <meta name="description" content="10-minute AI-powered assessment reveals where your business is stuck. Get personalized recommendations based on 25 years of diagnostic experience.">
    <link rel="stylesheet" href="style.css">
    <script src="translations.js"></script>
    
    <!-- Razorpay Integration -->
    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
    
    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-ZDL25WXPVP"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-ZDL25WXPVP');
    </script>
    
    <style>
        /* ============================================
           SCREEN VISIBILITY ‚Äî overrides any .card
           display from external style.css
           ============================================ */
        .assessment-hidden {
            display: none !important;
        }

        /* ============================================
           ENHANCED QUESTION UI/UX STYLES
           Clean, spacious, professional design
           ============================================ */
        
        /* Progress Section - Cleaner Design */
        .progress-wrapper {
            background: white;
            padding: 30px;
            border-radius: 12px;
            margin-bottom: 40px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .progress-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 18px;
        }
        
        .progress-label {
            font-size: 0.95rem;
            color: var(--text-muted);
            font-weight: 500;
        }
        
        .progress-count {
            font-size: 1.15rem;
            font-weight: 700;
            color: var(--accent-navy);
        }
        
        .progress-bar-container {
            background: #e5e7eb;
            height: 8px;
            border-radius: 4px;
            overflow: hidden;
        }
        
        .progress-bar-fill {
            background: linear-gradient(90deg, var(--accent-navy), var(--accent-gold));
            height: 100%;
            transition: width 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            border-radius: 4px;
        }
        
        /* Question Card - More Breathing Room */
        .question-card {
            background: white;
            padding: 60px 50px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            margin-bottom: 30px;
            min-height: 450px;
            display: flex;
            flex-direction: column;
        }
        
        .question-title {
            font-size: 1.6rem;
            font-weight: 600;
            color: var(--text-primary);
            line-height: 1.5;
            margin: 0 0 50px 0;
            text-align: center;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
        }
        
        /* Answer Options - Card-Based Design */
        .options-container {
            display: flex;
            flex-direction: column;
            gap: 16px;
            margin-bottom: auto;
        }
        
        .option-card {
            background: white;
            border: 2px solid #e5e7eb;
            /* FIX: right padding increased so text never overlaps the checkmark badge */
            padding: 24px 28px;
            border-radius: 10px;
            text-align: left;
            font-size: 1.05rem;
            line-height: 1.6;
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            width: 100%;
            display: block;
        }
        
        .option-card:hover {
            border-color: var(--accent-navy);
            background: #f8fafc;
            transform: translateY(-3px);
            box-shadow: 0 6px 16px rgba(0,0,0,0.12);
        }
        
        .option-card.selected {
            border-color: var(--accent-navy);
            background: linear-gradient(135deg, rgba(30, 58, 138, 0.06) 0%, rgba(59, 130, 246, 0.06) 100%);
            font-weight: 500;
            box-shadow: 0 4px 12px rgba(30, 58, 138, 0.15);
            /* FIX: extra right padding so text doesn't run under the checkmark */
            padding-right: 68px;
        }
        
        /* FIX: replaced display:flex (doesn't work on ::after in all browsers)
           with block + text-align + line-height approach */
        .option-card.selected::after {
            content: '‚úì';
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            width: 32px;
            height: 32px;
            background: var(--accent-navy);
            color: white;
            border-radius: 50%;
            display: block;
            text-align: center;
            line-height: 32px;
            font-weight: bold;
            font-size: 1rem;
        }
        
        .option-card:active {
            transform: scale(0.98);
        }
        
        /* Navigation Buttons - Enhanced Spacing */
        .nav-buttons {
            display: flex;
            gap: 16px;
            margin-top: 50px;
            padding-top: 30px;
            border-top: 1px solid #f1f5f9;
        }
        
        /* FIX: when prev button is hidden, next button fills full width */
        .nav-buttons .btn-primary:only-child {
            flex: 1;
        }

        .btn-secondary {
            background: white;
            border: 2px solid var(--accent-navy);
            color: var(--accent-navy);
            padding: 16px 32px;
            border-radius: 8px;
            font-size: 1.05rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            flex: 1;
        }
        
        .btn-secondary:hover {
            background: var(--accent-navy);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(30, 58, 138, 0.25);
        }
        
        .btn-primary {
            background: var(--accent-navy);
            color: white;
            padding: 16px 32px;
            border-radius: 8px;
            font-size: 1.05rem;
            font-weight: 600;
            border: 2px solid var(--accent-navy);
            cursor: pointer;
            transition: all 0.2s ease;
            flex: 2;
        }
        
        .btn-primary:hover:not(:disabled) {
            background: #1e3a8a;
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(30, 58, 138, 0.3);
        }
        
        .btn-primary:disabled {
            background: #e5e7eb;
            border-color: #e5e7eb;
            color: #9ca3af;
            cursor: not-allowed;
            transform: none;
        }

        /* Language Selector in Nav */
        .lang-select {
            padding: 6px 12px;
            font-size: 0.9rem;
            font-weight: 600;
            border: 2px solid var(--accent-navy);
            border-radius: 6px;
            background: white;
            color: var(--accent-navy);
            cursor: pointer;
        }

        /* Upgrade card in results ‚Äî ensure border closes fully */
        .upgrade-card {
            border: 2px solid var(--accent-navy);
            border-radius: 8px;
            padding: 30px;
            background: white;
            overflow: hidden; /* ensures border never looks "open" */
        }

        /* Loading spinner */
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 4px solid #f3f4f6;
            border-top: 4px solid var(--accent-navy);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }
        
        /* Mobile Responsiveness */
        @media (max-width: 768px) {
            .question-card {
                padding: 40px 24px;
                min-height: auto;
            }
            
            .question-title {
                font-size: 1.35rem;
                margin-bottom: 35px;
            }
            
            .option-card {
                padding: 20px 24px;
                font-size: 1rem;
            }

            .option-card.selected {
                padding-right: 60px;
            }
            
            .option-card.selected::after {
                width: 28px;
                height: 28px;
                line-height: 28px;
                font-size: 0.9rem;
                right: 16px;
            }
            
            .nav-buttons {
                flex-direction: column;
                gap: 12px;
            }
            
            .btn-primary, .btn-secondary {
                width: 100%;
                padding: 14px 24px;
            }
            
            .progress-wrapper {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container nav-wrapper">
            <a href="index.html" class="logo" id="header-logo">Kernorigin</a>
            <nav>
                <ul>
                    <li><a href="index.html">Home</a></li>
                    <li><a href="how-we-think.html">How We Think</a></li>
                    <li><a href="how-we-work.html">How We Work</a></li>
                    <li><a href="services.html">Services</a></li>
                    <li><a href="impact.html">Impact</a></li>
                    <li><a href="team.html">Team</a></li>
                    <li><a href="insights.html">Insights</a></li>
                    <li><a href="contact.html">Contact</a></li>
                    <li class="lang-item">
                        <select id="language-selector" class="lang-select" onchange="switchLanguage(this.value)">
                            <option value="en">üá¨üáß English</option>
                            <option value="hi">üáÆüá≥ ‡§π‡§ø‡§®‡•ç‡§¶‡•Ä</option>
                            <option value="kn">üáÆüá≥ ‡≤ï‡≤®‡≥ç‡≤®‡≤°</option>
                        </select>
                    </li>
                </ul>
            </nav>
        </div>
    </header>

    <main>
        <section class="section-padding" style="background: var(--bg-offwhite); min-height: 100vh;">
            <div class="container">
                <div class="readable-column">
                    <div class="text-center" style="margin-bottom: 50px;">
                        <span class="eyebrow" id="header-eyebrow">AI-Powered Diagnostic Tool</span>
                        <h1 id="main-title">Where Is Your Business Stuck?</h1>
                        <p style="font-size: 1.1rem; max-width: 650px; margin: 20px auto 0 auto;">
                            Answer 10 questions. Get personalized AI analysis based on our Seven Cylinders Framework‚Ñ¢. Takes 5 minutes.
                        </p>
                    </div>

                    <div id="assessment-container">

                        <!-- ============================================
                             INTRO SCREEN (visible by default)
                             ============================================ -->
                        <div id="intro-screen" class="card" style="background: white;">
                            <h3 style="margin-top: 0;">How This AI Assessment Works</h3>
                            <p>This assessment uses AI to evaluate your organization across seven critical dimensions:</p>
                            <div class="grid-2" style="gap: 15px; margin: 25px 0;">
                                <div style="padding: 15px; background: var(--bg-offwhite); border-radius: 4px;">
                                    <p style="margin: 0; font-weight: 600;">1. Strategic Clarity</p>
                                </div>
                                <div style="padding: 15px; background: var(--bg-offwhite); border-radius: 4px;">
                                    <p style="margin: 0; font-weight: 600;">2. Operational Excellence</p>
                                </div>
                                <div style="padding: 15px; background: var(--bg-offwhite); border-radius: 4px;">
                                    <p style="margin: 0; font-weight: 600;">3. People & Culture</p>
                                </div>
                                <div style="padding: 15px; background: var(--bg-offwhite); border-radius: 4px;">
                                    <p style="margin: 0; font-weight: 600;">4. Systems & Process</p>
                                </div>
                                <div style="padding: 15px; background: var(--bg-offwhite); border-radius: 4px;">
                                    <p style="margin: 0; font-weight: 600;">5. Financial Health</p>
                                </div>
                                <div style="padding: 15px; background: var(--bg-offwhite); border-radius: 4px;">
                                    <p style="margin: 0; font-weight: 600;">6. Market Position</p>
                                </div>
                            </div>
                            <div style="padding: 15px; background: var(--bg-offwhite); border-radius: 4px; margin-bottom: 30px;">
                                <p style="margin: 0; font-weight: 600; text-align: center;">7. Leadership Capacity</p>
                            </div>
                            
                            <div id="partner-banner" class="assessment-hidden" style="background: #f0f9ff; border-left: 4px solid var(--accent-navy); padding: 20px; margin-bottom: 30px;">
                                <p style="margin: 0; font-weight: 600; color: var(--accent-navy);" id="partner-message"></p>
                            </div>
                            
                            <div style="background: #fef9e7; border-left: 4px solid var(--accent-gold); padding: 20px; margin-bottom: 30px;">
                                <p style="margin: 0;"><strong>Your AI-powered analysis will reveal:</strong></p>
                                <ul style="margin: 10px 0 0 0; padding-left: 20px;">
                                    <li>Your primary bottleneck (what's actually stuck)</li>
                                    <li>Root cause vs. symptoms (why fixes haven't worked)</li>
                                    <li>Matched case studies (similar transformations)</li>
                                    <li id="intro-benefit">Specific next steps (diagnostic, workshop, or strategy)</li>
                                </ul>
                            </div>

                            <button onclick="startAssessment()" class="btn" id="start-btn" style="width: 100%; padding: 18px;">Begin AI Assessment ‚Üí</button>
                            
                            <p style="text-align: center; margin-top: 20px; font-size: 0.9rem; color: var(--text-muted);">
                                No signup required. Results delivered instantly + via email.
                            </p>
                        </div>

                        <!-- ============================================
                             QUESTION SCREEN
                             FIX: uses .assessment-hidden class instead of
                             inline display:none so it can't be overridden
                             by external .card styles
                             ============================================ -->
                        <div id="question-screen" class="assessment-hidden">
                            <!-- Progress Indicator -->
                            <div class="progress-wrapper">
                                <div class="progress-header">
                                    <span class="progress-label">Question Progress</span>
                                    <span class="progress-count"><span id="current-q">1</span> of 10</span>
                                </div>
                                <div class="progress-bar-container">
                                    <div id="progress-bar" class="progress-bar-fill" style="width: 10%;"></div>
                                </div>
                            </div>

                            <!-- Question Card -->
                            <div class="question-card">
                                <h3 id="question-text" class="question-title">Question text here</h3>
                                
                                <div id="answer-options" class="options-container"></div>

                                <div class="nav-buttons">
                                    <button onclick="previousQuestion()" id="prev-btn" class="btn-secondary assessment-hidden">‚Üê Previous</button>
                                    <button onclick="nextQuestion()" id="next-btn" class="btn-primary" disabled>Next Question ‚Üí</button>
                                </div>
                            </div>
                        </div>

                        <!-- ============================================
                             EMAIL CAPTURE SCREEN
                             FIX: uses .assessment-hidden class.
                             All form controls are correctly nested inside
                             this single div ‚Äî nothing leaks out.
                             ============================================ -->
                        <div id="email-capture-screen" class="card assessment-hidden" style="background: white;">
                            <h3>Get Your Personalized Diagnostic Report</h3>
                            <p style="color: var(--text-muted); margin-bottom: 30px;">
                                Enter your details to receive a comprehensive AI-powered analysis based on your responses.
                            </p>
                            
                            <form id="email-form" onsubmit="submitAssessment(event)">
                                <div style="margin-bottom: 20px;">
                                    <label style="display: block; font-weight: 600; margin-bottom: 8px;">Your Name *</label>
                                    <input type="text" id="user-name" required placeholder="Full name" 
                                           style="width: 100%; padding: 12px; border: 1px solid #e5e7eb; border-radius: 6px; font-size: 1rem;">
                                </div>
                                
                                <div style="margin-bottom: 20px;">
                                    <label style="display: block; font-weight: 600; margin-bottom: 8px;">Email Address *</label>
                                    <input type="email" id="user-email" required placeholder="name@company.com"
                                           style="width: 100%; padding: 12px; border: 1px solid #e5e7eb; border-radius: 6px; font-size: 1rem;">
                                </div>
                                
                                <div style="margin-bottom: 30px;">
                                    <label style="display: block; font-weight: 600; margin-bottom: 8px;">Company Name (Optional)</label>
                                    <input type="text" id="user-company" placeholder="Your company"
                                           style="width: 100%; padding: 12px; border: 1px solid #e5e7eb; border-radius: 6px; font-size: 1rem;">
                                </div>

                                <div id="coupon-section" class="assessment-hidden" style="background: #f0fdf4; border: 2px solid #10b981; padding: 20px; border-radius: 8px; margin-bottom: 25px;">
                                    <p style="margin: 0 0 10px 0; font-weight: 600; color: #059669;">‚úì Partner Coupon Applied</p>
                                    <input type="text" id="coupon-code" readonly
                                           style="width: 100%; padding: 10px; border: 1px solid #10b981; border-radius: 4px; background: white; font-family: monospace;">
                                    <p style="margin: 10px 0 0 0; font-size: 0.9rem; color: #059669;">Full diagnostic included (‚Çπ24,997 value)</p>
                                </div>

                                <!-- SMART INDUSTRY SELECTOR + CONTEXT FIELD -->
                                <div style="background: #f9fafb; padding: 18px; border-radius: 8px; border: 1px solid #e5e7eb; margin-bottom: 20px;">
                                    
                                    <!-- STEP 1: Select Broad Sector -->
                                    <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #1f2937;">
                                        1. Select Your Business Sector *
                                    </label>
                                    <select id="industry-level-1" onchange="updateSubIndustries()" required
                                            style="width: 100%; padding: 12px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 1rem; background: white; margin-bottom: 16px;">
                                        <option value="" disabled selected>Choose your sector...</option>
                                        <option value="Retail">Retail &amp; E-commerce</option>
                                        <option value="Manufacturing">Manufacturing &amp; Industrial</option>
                                        <option value="Professional Services">Professional Services</option>
                                        <option value="Technology">Technology &amp; SaaS</option>
                                        <option value="Healthcare">Healthcare &amp; Medical</option>
                                        <option value="Real Estate">Real Estate &amp; Construction</option>
                                        <option value="Restaurant">Restaurant &amp; Hospitality</option>
                                        <option value="General">Other / General Business</option>
                                    </select>

                                    <!-- STEP 2: Select Specific Niche (appears after sector selected) -->
                                    <div id="sub-industry-container" style="display: none; margin-bottom: 16px;">
                                        <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #1f2937;">
                                            2. Select Your Specific Niche *
                                        </label>
                                        <select id="industry-level-2"
                                                style="width: 100%; padding: 12px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 1rem; background: white;">
                                            <!-- Options populated dynamically by JavaScript below -->
                                        </select>
                                    </div>

                                    <!-- STEP 3: Describe Business Context -->
                                    <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #1f2937;">
                                        3. What's Your Main Business Challenge? (Optional)
                                    </label>
                                    <textarea id="user-context" rows="3" 
                                            placeholder="Example: We're struggling with high employee turnover and can't retain skilled staff..."
                                            style="width: 100%; padding: 12px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 1rem; font-family: inherit; resize: vertical;"></textarea>
                                    
                                    <p style="margin: 8px 0 0 0; font-size: 0.85rem; color: #6b7280;">
                                        üí° This helps our AI understand your specific situation and give more relevant insights
                                    </p>
                                </div>

                                <script>
                                // Niche options for each sector
                                const subIndustries = {
                                    "Retail": ["Fashion &amp; Apparel", "Grocery &amp; FMCG", "Electronics &amp; Tech", "Furniture &amp; Home", "General Retail"],
                                    "Manufacturing": ["Automotive", "Textiles &amp; Garments", "Chemicals &amp; Pharma", "Food &amp; Beverage", "General Manufacturing"],
                                    "Professional Services": ["Marketing Agency", "IT Consulting", "Legal &amp; Accounting", "HR Consulting", "General Services"],
                                    "Technology": ["SaaS B2B", "Consumer App", "Hardware &amp; IoT", "Dev Tools", "General Tech"],
                                    "Healthcare": ["Hospital", "Clinic &amp; Dental", "Pharma &amp; Medical Devices", "Diagnostics", "General Healthcare"],
                                    "Real Estate": ["Commercial Property", "Residential Sales", "Construction", "Property Management"],
                                    "Restaurant": ["Fine Dining", "QSR &amp; Fast Food", "Cafe &amp; Bakery", "Cloud Kitchen"],
                                    "General": ["Small Business", "Mid-Market", "Enterprise", "Non-Profit"]
                                };

                                // Show/hide niche selector based on sector selection
                                function updateSubIndustries() {
                                    const level1 = document.getElementById('industry-level-1');
                                    const level2 = document.getElementById('industry-level-2');
                                    const container = document.getElementById('sub-industry-container');
                                    const selectedSector = level1.value;

                                    // Clear previous options
                                    level2.innerHTML = '<option value="" disabled selected>Choose your niche...</option>';

                                    if (selectedSector &amp;&amp; subIndustries[selectedSector]) {
                                        // Show niche selector
                                        container.style.display = 'block';
                                        level2.setAttribute('required', 'true');
                                        
                                        // Populate niche options
                                        subIndustries[selectedSector].forEach(function(niche) {
                                            const option = document.createElement('option');
                                            option.value = niche;
                                            option.textContent = niche;
                                            level2.appendChild(option);
                                        });
                                    } else {
                                        // Hide niche selector
                                        container.style.display = 'none';
                                        level2.removeAttribute('required');
                                    }
                                }
                                </script>
                                <!-- END SMART SELECTOR -->

                                <button type="submit" class="btn" style="width: 100%; padding: 16px;">
                                    Get My Free Report ‚Üí
                                </button>
                            </form>
                            
                            <p style="text-align: center; margin-top: 20px; font-size: 0.85rem; color: var(--text-muted);">
                                üîí Your data is private and secure. We'll never spam you.
                            </p>
                        </div>
                        <!-- end #email-capture-screen -->

                        <!-- ============================================
                             LOADING SCREEN
                             ============================================ -->
                        <div id="loading-screen" class="card assessment-hidden" style="background: white; text-align: center; padding: 60px 30px;">
                            <div class="loading-spinner" style="margin-bottom: 30px;"></div>
                            <h3 style="margin-bottom: 15px;">Analyzing Your Business...</h3>
                            <p id="loading-message" style="color: var(--text-muted); font-size: 1.05rem;">
                                Our AI is evaluating your responses across all seven cylinders...
                            </p>
                        </div>

                        <!-- ============================================
                             RESULTS SCREEN
                             ============================================ -->
                        <div id="results-screen" class="card assessment-hidden" style="background: white;">
                            <div style="text-align: center; margin-bottom: 40px;">
                                <div style="display: inline-block; background: #10b981; color: white; padding: 12px 24px; border-radius: 50px; margin-bottom: 20px;">
                                    <span id="analysis-complete-badge" style="font-size: 1.1rem; font-weight: 600;">‚úì Analysis Complete</span>
                                </div>
                                <h2 id="results-title" style="margin: 0; color: var(--accent-navy);">Your Diagnostic Report</h2>
                                <p id="results-subtitle" style="color: var(--text-muted); margin-top: 10px;">A personalized analysis has been sent to your email</p>
                            </div>
                            
                            <div id="results-content"></div>
                        </div>

                    </div>
                    <!-- end #assessment-container -->
                </div>
            </div>
        </section>
    </main>

    <footer style="background: var(--bg-offwhite); padding: 50px 0; border-top: 1px solid #e5e7eb;">
        <div class="container" style="text-align: center;">
            <p style="margin: 0; font-size: 0.9rem; color: var(--text-muted);">
                ¬© 2026 <span id="footer-logo">Kernorigin</span>. All rights reserved.
            </p>
        </div>
    </footer>

    <script src="config.js"></script>
    <script src="mobile-menu.js"></script>
    
    <script>
        // ============================================
        // SUB-INDUSTRY SELECTOR
        // Moved out of form to avoid any nesting issues
        // ============================================
        const subIndustries = {
            "Retail":                ["Fashion & Apparel", "Grocery & FMCG", "Electronics & Tech", "Furniture & Home", "General Retail"],
            "Manufacturing":         ["Automotive", "Textiles & Garments", "Chemicals & Pharma", "Food & Beverage", "General Manufacturing"],
            "Professional Services": ["Marketing Agency", "IT Consulting", "Legal & Accounting", "HR Consulting", "General Services"],
            "Technology":            ["SaaS B2B", "Consumer App", "Hardware & IoT", "Dev Tools", "General Tech"],
            "Healthcare":            ["Hospital", "Clinic & Dental", "Pharma & Medical Devices", "Diagnostics", "General Healthcare"],
            "Real Estate":           ["Commercial Property", "Residential Sales", "Construction", "Property Management"],
            "Restaurant":            ["Fine Dining", "QSR & Fast Food", "Cafe & Bakery", "Cloud Kitchen"],
            "General":               ["Small Business", "Mid-Market", "Enterprise", "Non-Profit"]
        };

        function updateSubIndustries() {
            const level1    = document.getElementById('industry-level-1');
            const level2    = document.getElementById('industry-level-2');
            const container = document.getElementById('sub-industry-container');
            const sector    = level1.value;

            level2.innerHTML = '<option value="" disabled selected>Choose your niche...</option>';

            if (sector && subIndustries[sector]) {
                container.classList.remove('assessment-hidden');
                level2.setAttribute('required', 'true');
                subIndustries[sector].forEach(function(niche) {
                    const opt = document.createElement('option');
                    opt.value = niche;
                    opt.textContent = niche;
                    level2.appendChild(opt);
                });
            } else {
                container.classList.add('assessment-hidden');
                level2.removeAttribute('required');
            }
        }

        // ============================================
        // MULTILINGUAL SYSTEM
        // ============================================
        
        let currentLanguage = 'en';
        let t = (typeof TRANSLATIONS !== 'undefined') ? TRANSLATIONS.en : {};
        
        const urlParams = new URLSearchParams(window.location.search);
        const langParam = urlParams.get('lang');
        if (langParam && typeof TRANSLATIONS !== 'undefined' && TRANSLATIONS[langParam]) {
            currentLanguage = langParam;
            t = TRANSLATIONS[langParam];
        }
        
        function switchLanguage(lang) {
            currentLanguage = lang;
            if (typeof TRANSLATIONS !== 'undefined' && TRANSLATIONS[lang]) {
                t = TRANSLATIONS[lang];
            } else {
                t = (typeof TRANSLATIONS !== 'undefined' && TRANSLATIONS['en']) ? TRANSLATIONS['en'] : {};
            }
            const selector = document.getElementById('language-selector');
            if (selector) selector.value = lang;
            updatePageLanguage();
            try {
                const url = new URL(window.location);
                url.searchParams.set('lang', lang);
                window.history.pushState({}, '', url);
            } catch (e) {}
            if (currentQuestion >= 0 && currentQuestion < questions.length) {
                showQuestion(currentQuestion);
            }
        }
        
        function updatePageLanguage() {
            const titleMap = {
                en: "Where Is Your Business Stuck?",
                hi: "‡§Ü‡§™‡§ï‡§æ ‡§µ‡•ç‡§Ø‡§µ‡§∏‡§æ‡§Ø ‡§ï‡§π‡§æ‡§Å ‡§∞‡•Å‡§ï‡§æ ‡§π‡•Å‡§Ü ‡§π‡•à?",
                kn: "‡≤®‡≤ø‡≤Æ‡≥ç‡≤Æ ‡≤µ‡≥ç‡≤Ø‡≤æ‡≤™‡≤æ‡≤∞ ‡≤é‡≤≤‡≥ç‡≤≤‡≤ø ‡≤∏‡≤ø‡≤≤‡≥Å‡≤ï‡≤ø‡≤ï‡≥ä‡≤Ç‡≤°‡≤ø‡≤¶‡≥Ü?"
            };
            const btnMap = {
                en: "Begin AI Assessment ‚Üí",
                hi: "AI ‡§Æ‡•Ç‡§≤‡•ç‡§Ø‡§æ‡§Ç‡§ï‡§® ‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡•á‡§Ç ‚Üí",
                kn: "AI ‡≤Æ‡≥å‡≤≤‡≥ç‡≤Ø‡≤Æ‡≤æ‡≤™‡≤®‡≤µ‡≤®‡≥ç‡≤®‡≥Å ‡≤™‡≥ç‡≤∞‡≤æ‡≤∞‡≤Ç‡≤≠‡≤ø‡≤∏‡≤ø ‚Üí"
            };
            const el = document.getElementById('main-title');
            if (el) el.textContent = titleMap[currentLanguage] || titleMap.en;
            const btn = document.getElementById('start-btn');
            if (btn) btn.textContent = btnMap[currentLanguage] || btnMap.en;
        }
        
        window.addEventListener('DOMContentLoaded', function() {
            const sel = document.getElementById('language-selector');
            if (sel) sel.value = currentLanguage;
            updatePageLanguage();
        });

        // ============================================
        // PARTNER SYSTEM
        // ============================================
        
        const partnerId    = urlParams.get('partner') || '';
        const prefillCoupon = urlParams.get('coupon')  || '';
        
        let partnerBranding = null;
        let assessmentState = {
            mode:       'free',
            partnerId:  partnerId,
            couponCode: prefillCoupon,
            name: '', email: '', company: '',
            fullAnswers: {}, cylinderScores: {}
        };

        if (partnerId)     loadPartnerBranding(partnerId);
        if (prefillCoupon) { assessmentState.mode = 'coupon'; assessmentState.couponCode = prefillCoupon; }

        async function loadPartnerBranding(pid) {
            try {
                const res  = await fetch(`${API_CONFIG.URL}?action=get_partner_branding&partnerId=${pid}`);
                const data = await res.json();
                if (data.status === 'success' && data.partner) {
                    partnerBranding = data.partner;
                    assessmentState.mode = 'coupon';
                    applyPartnerBranding(data.partner);
                }
            } catch (err) { console.error('Partner branding load failed:', err); }
        }
        
        function applyPartnerBranding(partner) {
            document.title = `Free Business Assessment | ${partner.branding.displayName}`;
            document.getElementById('header-logo').textContent = partner.branding.displayName;
            document.getElementById('footer-logo').textContent = `${partner.branding.displayName} √ó KERNORIGIN`;
            document.documentElement.style.setProperty('--accent-navy',  partner.branding.primaryColor);
            document.documentElement.style.setProperty('--accent-gold', partner.branding.secondaryColor);
            document.getElementById('header-eyebrow').textContent = `Complimentary Diagnostic via ${partner.name}`;
            document.getElementById('partner-banner').classList.remove('assessment-hidden');
            document.getElementById('partner-message').textContent =
                `‚úì You're receiving a complimentary full diagnostic courtesy of ${partner.name} (‚Çπ24,997 value)`;
            document.getElementById('intro-benefit').innerHTML =
                `<strong>FREE 35-page comprehensive report</strong> (normally ‚Çπ24,997)`;
        }
        
        // ============================================
        // ASSESSMENT QUESTIONS
        // ============================================
        
        const questions = [
            {
                text: "How clear is your strategic direction?",
                cylinder: "strategy",
                options: [
                    { text: "Crystal clear - everyone aligned on goals",       score: 4 },
                    { text: "Mostly clear - some confusion on priorities",      score: 3 },
                    { text: "Unclear - different people, different visions",    score: 2 },
                    { text: "No clarity - just reacting to problems",           score: 1 }
                ]
            },
            {
                text: "How effective are your core operations?",
                cylinder: "operations",
                options: [
                    { text: "Smooth - repeatable processes, consistent quality", score: 4 },
                    { text: "Functional - works but needs improvement",           score: 3 },
                    { text: "Chaotic - lots of firefighting",                     score: 2 },
                    { text: "Broken - constant crises and failures",              score: 1 }
                ]
            },
            {
                text: "How would you describe your technology systems?",
                cylinder: "systems",
                options: [
                    { text: "Modern, integrated, reliable",                       score: 4 },
                    { text: "Adequate but aging or disconnected",                  score: 3 },
                    { text: "Outdated or manual workarounds common",               score: 2 },
                    { text: "Broken or non-existent systems",                      score: 1 }
                ]
            },
            {
                text: "How would you rate your team's capability?",
                cylinder: "people",
                options: [
                    { text: "High performers - skilled and engaged",               score: 4 },
                    { text: "Solid team - some skill gaps",                        score: 3 },
                    { text: "Struggling - high turnover or low morale",            score: 2 },
                    { text: "Critical capability gaps holding us back",            score: 1 }
                ]
            },
            {
                text: "How healthy is your cash flow?",
                cylinder: "financial",
                options: [
                    { text: "Strong - positive and growing",                       score: 4 },
                    { text: "Stable - managing but tight",                         score: 3 },
                    { text: "Stressed - frequent cash crunches",                   score: 2 },
                    { text: "Critical - survival mode",                            score: 1 }
                ]
            },
            {
                text: "How strong is your market position?",
                cylinder: "market",
                options: [
                    { text: "Market leader - clear differentiation",               score: 4 },
                    { text: "Competitive - holding our own",                       score: 3 },
                    { text: "Struggling - losing ground",                          score: 2 },
                    { text: "Unclear positioning or commoditized",                 score: 1 }
                ]
            },
            {
                text: "How effective is your leadership team?",
                cylinder: "leadership",
                options: [
                    { text: "Strong - clear vision, good decisions",               score: 4 },
                    { text: "Functional - gets things done",                       score: 3 },
                    { text: "Weak - inconsistent or unclear",                      score: 2 },
                    { text: "Dysfunctional - major leadership gaps",               score: 1 }
                ]
            },
            {
                text: "How scalable are your current processes?",
                cylinder: "operations",
                options: [
                    { text: "Highly scalable - documented and automated",          score: 4 },
                    { text: "Can scale with some effort",                          score: 3 },
                    { text: "Barely keeping up with current volume",               score: 2 },
                    { text: "Breaking under current load",                         score: 1 }
                ]
            },
            {
                text: "How well do you understand your customer needs?",
                cylinder: "market",
                options: [
                    { text: "Deep understanding - backed by data",                 score: 4 },
                    { text: "Good understanding - some gaps",                      score: 3 },
                    { text: "Surface level - mostly assumptions",                  score: 2 },
                    { text: "Unclear - guessing or outdated info",                 score: 1 }
                ]
            },
            {
                text: "How predictable is your revenue?",
                cylinder: "financial",
                options: [
                    { text: "Very predictable - strong pipelines",                 score: 4 },
                    { text: "Somewhat predictable - some volatility",              score: 3 },
                    { text: "Unpredictable - month to month uncertainty",          score: 2 },
                    { text: "Highly volatile - survival mode",                     score: 1 }
                ]
            }
        ];

        let currentQuestion = 0;
        let answers = [];

        // ============================================
        // SCROLL HELPER
        // ============================================
        function scrollToAssessment() {
            const container = document.getElementById('assessment-container');
            if (!container) return;
            const header = document.querySelector('header');
            const headerH = header ? header.offsetHeight : 0;
            const top = container.getBoundingClientRect().top + window.scrollY - headerH - 20;
            window.scrollTo({ top, behavior: 'smooth' });
        }

        // ============================================
        // SCREEN SHOW / HIDE HELPERS
        // Always use these ‚Äî never set .style.display directly
        // ============================================
        function showScreen(id) {
            document.getElementById(id).classList.remove('assessment-hidden');
        }
        function hideScreen(id) {
            document.getElementById(id).classList.add('assessment-hidden');
        }

        // ============================================
        // ASSESSMENT FLOW
        // ============================================

        function startAssessment() {
            hideScreen('intro-screen');
            showScreen('question-screen');
            scrollToAssessment();
            showQuestion(0);
            gtag('event', 'assessment_started', { event_category: 'engagement', event_label: assessmentState.mode });
        }

        function showQuestion(index) {
            currentQuestion = index;
            const q = questions[index];

            document.getElementById('current-q').textContent  = index + 1;
            document.getElementById('progress-bar').style.width = ((index + 1) / questions.length * 100) + '%';

            const qKey        = 'q' + (index + 1);
            const questionText = (t && t[qKey]) ? t[qKey] : q.text;
            document.getElementById('question-text').textContent = questionText;
            
            const optionsDiv = document.getElementById('answer-options');
            optionsDiv.innerHTML = '';
            
            q.options.forEach((option, i) => {
                const btn = document.createElement('button');
                btn.className = 'option-card';
                const optKey    = 'q' + (index + 1) + '_opt' + (i + 1);
                btn.textContent = (t && t[optKey]) ? t[optKey] : option.text;
                btn.onclick     = () => selectAnswer(i);
                if (answers[index] === i) btn.classList.add('selected');
                optionsDiv.appendChild(btn);
            });

            // Prev button
            const prevBtn = document.getElementById('prev-btn');
            if (index > 0) {
                prevBtn.classList.remove('assessment-hidden');
            } else {
                prevBtn.classList.add('assessment-hidden');
            }

            document.getElementById('next-btn').disabled    = (answers[index] === undefined);
            document.getElementById('next-btn').textContent = (index === questions.length - 1) ? 'See Results ‚Üí' : 'Next Question ‚Üí';
            
            setTimeout(scrollToAssessment, 50);
        }

        function selectAnswer(optionIndex) {
            answers[currentQuestion] = optionIndex;
            document.querySelectorAll('.option-card').forEach((btn, idx) => {
                btn.classList.toggle('selected', idx === optionIndex);
            });
            document.getElementById('next-btn').disabled = false;
        }

        function previousQuestion() {
            if (currentQuestion > 0) showQuestion(currentQuestion - 1);
        }

        function nextQuestion() {
            if (currentQuestion < questions.length - 1) {
                showQuestion(currentQuestion + 1);
            } else {
                finishAssessment();
            }
        }

        function finishAssessment() {
            hideScreen('question-screen');
            showScreen('email-capture-screen');

            // Show coupon section only for coupon / partner mode
            if (assessmentState.mode === 'coupon' && assessmentState.couponCode) {
                document.getElementById('coupon-section').classList.remove('assessment-hidden');
                document.getElementById('coupon-code').value = assessmentState.couponCode;
            }

            scrollToAssessment();
            gtag('event', 'assessment_completed', { event_category: 'engagement', event_label: 'all_questions_answered' });
        }

        // ============================================
        // SUBMIT ASSESSMENT
        // ============================================

        // ============================================
        // 5. SUBMIT ASSESSMENT (v15 Platinum)
        // ============================================

        async function submitAssessment(e) {
            e.preventDefault();
            
            // Switch to loading screen
            hideScreen('email-capture-screen');
            showScreen('loading-screen');
            scrollToAssessment();
            
            // Collect user data
            assessmentState.name = document.getElementById('user-name').value;
            assessmentState.email = document.getElementById('user-email').value;
            assessmentState.company = document.getElementById('user-company').value || 'Not specified';
            
            // Format answers by cylinder
            const scores = {
                strategy: 0,
                operations: 0,
                systems: 0,
                people: 0,
                financial: 0,
                market: 0,
                leadership: 0
            };
            const formattedAnswers = {};
            
            // Process all answers with multilingual support
            answers.forEach((answerIndex, questionIndex) => {
                const q = questions[questionIndex];
                const selectedOption = q.options[answerIndex];
                
                if (!formattedAnswers[q.cylinder]) {
                    formattedAnswers[q.cylinder] = [];
                }
                
                // Use translated text if available
                const qKey = 'q' + (questionIndex + 1);
                const optKey = 'q' + (questionIndex + 1) + '_opt' + (answerIndex + 1);
                
                formattedAnswers[q.cylinder].push({
                    question: (t && t[qKey]) ? t[qKey] : q.text,
                    answer: (t && t[optKey]) ? t[optKey] : selectedOption.text,
                    score: selectedOption.score
                });
                
                if (q.cylinder !== 'general') {
                    scores[q.cylinder] += selectedOption.score;
                }
            });

            try {
                // Determine endpoint based on mode
                const action = (assessmentState.mode === 'coupon') 
                    ? 'analyze_assessment_partner' 
                    : 'analyze_assessment';

                // === PLATINUM: INDUSTRY + CONTEXT CAPTURE ===
                const level1 = document.getElementById('industry-level-1').value;
                const level2El = document.getElementById('industry-level-2');
                const level2 = (level2El && level2El.value) ? level2El.value : '';
                const context = document.getElementById('user-context').value.trim();
                
                // Construct final industry string
                // Format: "Sector - Niche" or just "Sector" if no niche selected
                const finalIndustry = level2 ? (level1 + ' - ' + level2) : level1;
                // === END PLATINUM LOGIC ===

                // Get language selection
                const langSelector = document.getElementById('language-selector');
                const submitLang = (langSelector && langSelector.value) || currentLanguage || 'en';

                // Build form data
                const formData = new FormData();
                formData.append('action', action);
                formData.append('apiKey', API_CONFIG.PUBLIC_KEY);
                formData.append('name', assessmentState.name);
                formData.append('email', assessmentState.email);
                formData.append('company', assessmentState.company);
                formData.append('industry', finalIndustry);
                formData.append('context', context);
                formData.append('language', submitLang);
                formData.append('answers', JSON.stringify(formattedAnswers));
                formData.append('scores', JSON.stringify(scores));
                
                // Add coupon code if in coupon mode
                if (assessmentState.mode === 'coupon') {
                    formData.append('couponCode', assessmentState.couponCode);
                }

                // Submit to backend
                const response = await fetch(API_CONFIG.URL, {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();
                
                if (result.status === 'error') {
                    throw new Error(result.error || result.message);
                }
                
                // Display results
                displayResults(result);
                
                // Track conversion
                gtag('event', 'assessment_submitted', {
                    event_category: 'conversion',
                    event_label: assessmentState.mode,
                    value: assessmentState.mode === 'coupon' ? 24997 : 0
                });
                
            } catch (error) {
                console.error('Assessment submission error:', error);
                hideScreen('loading-screen');
                showScreen('email-capture-screen');
                alert('Failed to generate analysis. Please try again or contact support.');
            }
        }

        // ============================================
        // DISPLAY RESULTS
        // FIX: all div pairs are explicitly balanced,
        //      upgrade card uses .upgrade-card class
        //      (overflow:hidden ensures border closes visually)
        // ============================================
        function displayResults(result) {
            hideScreen('loading-screen');
            showScreen('results-screen');
            scrollToAssessment();

            // Translated badge / title / subtitle
            const badges = { en:'‚úì Analysis Complete', hi:'‚úì ‡§µ‡§ø‡§∂‡•ç‡§≤‡•á‡§∑‡§£ ‡§™‡•Ç‡§∞‡•ç‡§£', kn:'‚úì ‡≤µ‡≤ø‡≤∂‡≥ç‡≤≤‡≥á‡≤∑‡≤£‡≥Ü ‡≤™‡≥Ç‡≤∞‡≥ç‡≤£‡≤ó‡≥ä‡≤Ç‡≤°‡≤ø‡≤¶‡≥Ü' };
            const titles = { en:'Your Diagnostic Report', hi:'‡§Ü‡§™‡§ï‡•Ä ‡§®‡§ø‡§¶‡§æ‡§® ‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü', kn:'‡≤®‡≤ø‡≤Æ‡≥ç‡≤Æ ‡≤∞‡≥ã‡≤ó‡≤®‡≤ø‡≤∞‡≥ç‡≤£‡≤Ø ‡≤µ‡≤∞‡≤¶‡≤ø' };
            const subs   = {
                en:'A personalized analysis has been sent to your email',
                hi:'‡§è‡§ï ‡§µ‡•ç‡§Ø‡§ï‡•ç‡§§‡§ø‡§ó‡§§ ‡§µ‡§ø‡§∂‡•ç‡§≤‡•á‡§∑‡§£ ‡§Ü‡§™‡§ï‡•á ‡§à‡§Æ‡•á‡§≤ ‡§™‡§∞ ‡§≠‡•á‡§ú ‡§¶‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ ‡§π‡•à',
                kn:'‡≤µ‡≥à‡≤Ø‡≤ï‡≥ç‡≤§‡≥Ä‡≤ï‡≤∞‡≤ø‡≤∏‡≤ø‡≤¶ ‡≤µ‡≤ø‡≤∂‡≥ç‡≤≤‡≥á‡≤∑‡≤£‡≥Ü‡≤Ø‡≤®‡≥ç‡≤®‡≥Å ‡≤®‡≤ø‡≤Æ‡≥ç‡≤Æ ‡≤á‡≤Æ‡≥á‡≤≤‡≥ç‚Äå‡≤ó‡≥Ü ‡≤ï‡≤≥‡≥Å‡≤π‡≤ø‡≤∏‡≤≤‡≤æ‡≤ó‡≤ø‡≤¶‡≥Ü'
            };

            const badgeEl = document.getElementById('analysis-complete-badge');
            const titleEl = document.getElementById('results-title');
            const subEl   = document.getElementById('results-subtitle');
            if (badgeEl) badgeEl.textContent = badges[currentLanguage] || badges.en;
            if (titleEl) titleEl.textContent = titles[currentLanguage] || titles.en;
            if (subEl)   subEl.textContent   = subs[currentLanguage]   || subs.en;

            const container = document.getElementById('results-content');

            if (assessmentState.mode === 'coupon') {
                // Partner / coupon mode ‚Äî full report sent
                const emailConfirm = {
                    en: `Full Diagnostic Report Sent to ${assessmentState.email}`,
                    hi: `‡§∏‡§Ç‡§™‡•Ç‡§∞‡•ç‡§£ ‡§®‡§ø‡§¶‡§æ‡§® ‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü ${assessmentState.email} ‡§ï‡•ã ‡§≠‡•á‡§ú‡•Ä ‡§ó‡§à`,
                    kn: `‡≤∏‡≤Ç‡≤™‡≥Ç‡≤∞‡≥ç‡≤£ ‡≤∞‡≥ã‡≤ó‡≤®‡≤ø‡≤∞‡≥ç‡≤£‡≤Ø ‡≤µ‡≤∞‡≤¶‡≤ø ${assessmentState.email} ‡≤ó‡≥Ü ‡≤ï‡≤≥‡≥Å‡≤π‡≤ø‡≤∏‡≤≤‡≤æ‡≤ó‡≤ø‡≤¶‡≥Ü`
                };
                const partnerName = partnerBranding ? partnerBranding.name : 'our partner';
                const checkEmail  = {
                    en: `Check your email for the complete 35-page analysis (courtesy of ${partnerName})`,
                    hi: `‡§∏‡§Ç‡§™‡•Ç‡§∞‡•ç‡§£ 35-‡§™‡•É‡§∑‡•ç‡§† ‡§µ‡§ø‡§∂‡•ç‡§≤‡•á‡§∑‡§£ ‡§ï‡•á ‡§≤‡§ø‡§è ‡§Ö‡§™‡§®‡§æ ‡§à‡§Æ‡•á‡§≤ ‡§ú‡§æ‡§Ç‡§ö‡•á‡§Ç (${partnerName} ‡§ï‡•á ‡§∏‡•å‡§ú‡§®‡•ç‡§Ø ‡§∏‡•á)`,
                    kn: `‡≤∏‡≤Ç‡≤™‡≥Ç‡≤∞‡≥ç‡≤£ 35-‡≤™‡≥Å‡≤ü‡≤¶ ‡≤µ‡≤ø‡≤∂‡≥ç‡≤≤‡≥á‡≤∑‡≤£‡≥Ü‡≤ó‡≤æ‡≤ó‡≤ø ‡≤®‡≤ø‡≤Æ‡≥ç‡≤Æ ‡≤á‡≤Æ‡≥á‡≤≤‡≥ç ‡≤™‡≤∞‡≤ø‡≤∂‡≥Ä‡≤≤‡≤ø‡≤∏‡≤ø (${partnerName}‡≤∞ ‡≤∏‡≥å‡≤ú‡≤®‡≥ç‡≤Ø‡≤¶‡≤ø‡≤Ç‡≤¶)`
                };

                container.innerHTML =
                    `<div style="background:#f0fdf4;border:2px solid #10b981;padding:25px;border-radius:8px;margin-bottom:30px;">` +
                        `<p style="margin:0;font-weight:600;font-size:1.1rem;color:#059669;">` +
                            `‚úì ${emailConfirm[currentLanguage] || emailConfirm.en}` +
                        `</p>` +
                        `<p style="margin:10px 0 0 0;color:#059669;">` +
                            `${checkEmail[currentLanguage] || checkEmail.en}` +
                        `</p>` +
                    `</div>` +
                    result.analysis;

            } else {
                // Free mode ‚Äî show summary + upgrade card
                const summaryLabel = {
                    en: `Summary Report Sent to ${assessmentState.email}`,
                    hi: `‡§∏‡§æ‡§∞‡§æ‡§Ç‡§∂ ‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü ${assessmentState.email} ‡§ï‡•ã ‡§≠‡•á‡§ú‡•Ä ‡§ó‡§à`,
                    kn: `‡≤∏‡≤æ‡≤∞‡≤æ‡≤Ç‡≤∂ ‡≤µ‡≤∞‡≤¶‡≤ø ${assessmentState.email} ‡≤ó‡≥Ü ‡≤ï‡≤≥‡≥Å‡≤π‡≤ø‡≤∏‡≤≤‡≤æ‡≤ó‡≤ø‡≤¶‡≥Ü`
                };
                const upgradeTitle = {
                    en: 'Unlock Deeper Insights',
                    hi: '‡§ó‡§π‡§∞‡•Ä ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä ‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§ ‡§ï‡§∞‡•á‡§Ç',
                    kn: '‡≤Ü‡≤≥‡≤µ‡≤æ‡≤¶ ‡≤í‡≤≥‡≤®‡≥ã‡≤ü‡≤ó‡≤≥‡≤®‡≥ç‡≤®‡≥Å ‡≤Ö‡≤®‡≥ç‚Äå‡≤≤‡≤æ‡≤ï‡≥ç ‡≤Æ‡≤æ‡≤°‡≤ø'
                };
                const reportTitle = {
                    en: 'Full 35-Page Diagnostic Report',
                    hi: '‡§∏‡§Ç‡§™‡•Ç‡§∞‡•ç‡§£ 35-‡§™‡•É‡§∑‡•ç‡§† ‡§®‡§ø‡§¶‡§æ‡§® ‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü',
                    kn: '‡≤∏‡≤Ç‡≤™‡≥Ç‡≤∞‡≥ç‡≤£ 35-‡≤™‡≥Å‡≤ü‡≤¶ ‡≤∞‡≥ã‡≤ó‡≤®‡≤ø‡≤∞‡≥ç‡≤£‡≤Ø ‡≤µ‡≤∞‡≤¶‡≤ø'
                };
                const upgradeBtn = {
                    en: 'Upgrade to Full Report ‚Üí',
                    hi: '‡§™‡•Ç‡§∞‡•ç‡§£ ‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü ‡§Æ‡•á‡§Ç ‡§Ö‡§™‡§ó‡•ç‡§∞‡•á‡§° ‡§ï‡§∞‡•á‡§Ç ‚Üí',
                    kn: '‡≤∏‡≤Ç‡≤™‡≥Ç‡≤∞‡≥ç‡≤£ ‡≤µ‡≤∞‡≤¶‡≤ø‡≤ó‡≥Ü ‡≤Ö‡≤™‡≥ç‚Äå‡≤ó‡≥ç‡≤∞‡≥á‡≤°‡≥ç ‡≤Æ‡≤æ‡≤°‡≤ø ‚Üí'
                };

                // NOTE: every open <div> below has a matching </div>
                // The .upgrade-card class adds overflow:hidden so the border
                // always renders as a fully closed box
                container.innerHTML =
                    // Summary sent banner
                    `<div style="background:#eff6ff;border-left:4px solid var(--accent-navy);padding:20px;margin-bottom:30px;">` +
                        `<p style="margin:0;font-weight:600;color:var(--accent-navy);">` +
                            `‚úì ${summaryLabel[currentLanguage] || summaryLabel.en}` +
                        `</p>` +
                    `</div>` +

                    // AI-generated analysis HTML
                    result.analysis +

                    // Upgrade section
                    `<div style="margin-top:50px;">` +
                        `<h3 style="text-align:center;margin-bottom:30px;color:var(--accent-navy);">` +
                            `${upgradeTitle[currentLanguage] || upgradeTitle.en}` +
                        `</h3>` +

                        // FIX: .upgrade-card has overflow:hidden ‚Äî border always closes visually
                        `<div class="upgrade-card">` +

                            // Header row: title + price
                            `<div style="display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:20px;">` +

                                `<div>` +
                                    `<h4 style="margin:0 0 10px 0;color:var(--accent-navy);">` +
                                        `${reportTitle[currentLanguage] || reportTitle.en}` +
                                    `</h4>` +
                                    `<p style="margin:0;color:var(--text-muted);font-size:0.95rem;">` +
                                        `Complete 7-cylinder breakdown with 90-day roadmap` +
                                    `</p>` +
                                `</div>` +

                                `<div style="text-align:right;white-space:nowrap;margin-left:20px;">` +
                                    `<div style="text-decoration:line-through;color:#999;font-size:0.9rem;">‚Çπ29,997</div>` +
                                    `<div style="font-weight:700;color:var(--accent-navy);font-size:1.4rem;">‚Çπ24,997</div>` +
                                `</div>` +

                            `</div>` +
                            // end header row

                            `<ul style="margin:20px 0 30px 0;padding-left:20px;color:var(--text-primary);">` +
                                `<li style="margin-bottom:8px;">Root cause analysis (not just symptoms)</li>` +
                                `<li style="margin-bottom:8px;">Industry benchmarking &amp; comparison</li>` +
                                `<li style="margin-bottom:8px;">90-day action roadmap</li>` +
                                `<li style="margin-bottom:8px;">Matched case studies</li>` +
                                `<li>Build / buy / partner recommendations</li>` +
                            `</ul>` +

                            `<button onclick="showPayment('institutional')" class="btn" style="width:100%;padding:16px;font-size:1.05rem;">` +
                                `${upgradeBtn[currentLanguage] || upgradeBtn.en}` +
                            `</button>` +

                        `</div>` +
                        // end .upgrade-card

                    `</div>`;
                    // end upgrade section
            }
        }

        // ============================================
        // RAZORPAY PAYMENT
        // TODO: Replace 'rzp_live_YOUR_ACTUAL_KEY' with
        //       your real Razorpay key before going live.
        // ============================================
        function showPayment(type) {
            const rzp = new Razorpay({
                key:         'rzp_live_YOUR_ACTUAL_KEY', // ‚Üê replace before launch
                amount:      2499700,
                currency:    'INR',
                name:        'Kernorigin',
                description: 'Full Institutional Diagnostic',
                prefill: { name: assessmentState.name, email: assessmentState.email },
                theme: { color: '#002244' },
                handler: function(response) {
                    alert('Payment successful! Generating your full report...');
                    // TODO: POST payment ID to backend to trigger full report generation
                }
            });
            rzp.open();
        }
    </script>
</body>
</html>