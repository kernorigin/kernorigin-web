<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Free Business Assessment | Kernorigin</title>
    <meta name="description" content="10-minute AI-powered assessment reveals where your business is stuck. Get personalized recommendations based on 25 years of diagnostic experience.">
    <link rel="stylesheet" href="../style.css">
    
    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-ZDL25WXPVP"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-ZDL25WXPVP');
    </script>
</head>
<body>
    <header>
        <div class="container nav-wrapper">
            <a href="../index.html" class="logo">Kernorigin</a>
            <nav>
                <ul>
                    <li><a href="../index.html">Home</a></li>
                    <li><a href="../how-we-think.html">How We Think</a></li>
                    <li><a href="../how-we-work.html">How We Work</a></li>
                    <li><a href="../services.html">Services</a></li>
                    <li><a href="../impact.html">Impact</a></li>
                    <li><a href="../team.html">Team</a></li>
                    <li><a href="../insights.html">Insights</a></li>
                    <li><a href="../contact.html">Contact</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <main>
        <section class="section-padding" style="background: var(--bg-offwhite);">
            <div class="container">
                <div class="readable-column">
                    <div class="text-center" style="margin-bottom: 50px;">
                        <span class="eyebrow">AI-Powered Diagnostic Tool</span>
                        <h1>Where Is Your Business Stuck?</h1>
                        <p style="font-size: 1.1rem; max-width: 650px; margin: 20px auto 0 auto;">
                            Answer 10 questions. Get personalized AI analysis based on our Seven Cylinders Framework™. Takes 5 minutes.
                        </p>
                    </div>

                    <div id="assessment-container">
                        <!-- Introduction Screen -->
                        <div id="intro-screen" class="card" style="background: white;">
                            <h3 style="margin-top: 0;">How This AI Assessment Works</h3>
                            <p>This assessment uses AI to evaluate your organization across seven critical dimensions:</p>
                            <div class="grid-2" style="gap: 15px; margin: 25px 0;">
                                <div style="padding: 15px; background: var(--bg-offwhite); border-radius: 4px;">
                                    <p style="margin: 0; font-weight: 600;">1. Strategic Clarity</p>
                                </div>
                                <div style="padding: 15px; background: var(--bg-offwhite); border-radius: 4px;">
                                    <p style="margin: 0; font-weight: 600;">2. Operational Excellence</p>
                                </div>
                                <div style="padding: 15px; background: var(--bg-offwhite); border-radius: 4px;">
                                    <p style="margin: 0; font-weight: 600;">3. People & Culture</p>
                                </div>
                                <div style="padding: 15px; background: var(--bg-offwhite); border-radius: 4px;">
                                    <p style="margin: 0; font-weight: 600;">4. Systems & Process</p>
                                </div>
                                <div style="padding: 15px; background: var(--bg-offwhite); border-radius: 4px;">
                                    <p style="margin: 0; font-weight: 600;">5. Financial Health</p>
                                </div>
                                <div style="padding: 15px; background: var(--bg-offwhite); border-radius: 4px;">
                                    <p style="margin: 0; font-weight: 600;">6. Market Position</p>
                                </div>
                            </div>
                            <div style="padding: 15px; background: var(--bg-offwhite); border-radius: 4px; margin-bottom: 30px;">
                                <p style="margin: 0; font-weight: 600; text-align: center;">7. Leadership Capacity</p>
                            </div>
                            
                            <div style="background: #fef9e7; border-left: 4px solid var(--accent-gold); padding: 20px; margin-bottom: 30px;">
                                <p style="margin: 0;"><strong>Your AI-powered analysis will reveal:</strong></p>
                                <ul style="margin: 10px 0 0 0; padding-left: 20px;">
                                    <li>Your primary bottleneck (what's actually stuck)</li>
                                    <li>Root cause vs. symptoms (why fixes haven't worked)</li>
                                    <li>Matched case studies (similar transformations)</li>
                                    <li>Specific next steps (diagnostic, workshop, or strategy)</li>
                                </ul>
                            </div>

                            <button onclick="startAssessment()" class="btn" style="width: 100%; padding: 18px;">Begin AI Assessment →</button>
                            
                            <p style="text-align: center; margin-top: 20px; font-size: 0.9rem; color: var(--text-muted);">
                                No signup required. Results delivered instantly + via email.
                            </p>
                        </div>

                        <!-- Questions Screen -->
                        <div id="question-screen" class="card" style="background: white; display: none;">
                            <div style="background: var(--bg-offwhite); padding: 15px; border-radius: 4px; margin-bottom: 30px;">
                                <p style="margin: 0; font-size: 0.9rem; color: var(--text-muted);">
                                    Question <span id="current-q">1</span> of 10
                                </p>
                                <div style="background: #e5e7eb; height: 6px; border-radius: 3px; margin-top: 10px;">
                                    <div id="progress-bar" style="background: var(--accent-navy); height: 100%; width: 10%; transition: width 0.3s; border-radius: 3px;"></div>
                                </div>
                            </div>

                            <h3 id="question-text" style="margin: 0 0 30px 0; font-size: 1.3rem;">Question text here</h3>
                            
                            <div id="answer-options"></div>

                            <div style="margin-top: 30px; display: flex; gap: 15px;">
                                <button onclick="previousQuestion()" id="prev-btn" class="btn-outline" style="flex: 1; display: none;">← Previous</button>
                                <button onclick="nextQuestion()" id="next-btn" class="btn" style="flex: 2;" disabled>Next Question →</button>
                            </div>
                        </div>

                        <!-- Email Capture Screen (NEW) -->
                        <div id="email-capture-screen" class="card" style="background: white; display: none;">
                            <h3 style="margin-top: 0;">Almost There! Get Your AI Analysis</h3>
                            <p>Our AI is analyzing your responses against 25 years of case data. Enter your email to receive your personalized diagnostic report.</p>
                            
                            <form id="email-capture-form" onsubmit="submitForAnalysis(event)">
                                <label>Your Name</label>
                                <input type="text" id="user-name" required placeholder="Full Name">
                                
                                <label>Email Address</label>
                                <input type="email" id="user-email" required placeholder="name@company.com">
                                
                                <label>Company/Organization (Optional)</label>
                                <input type="text" id="user-company" placeholder="Your Company">
                                
                                <div style="background: #f0f9ff; padding: 15px; border-radius: 4px; margin-bottom: 20px;">
                                    <p style="margin: 0; font-size: 0.9rem;"><strong>What you'll get:</strong></p>
                                    <ul style="margin: 5px 0 0 0; padding-left: 20px; font-size: 0.9rem;">
                                        <li>Personalized AI diagnostic report (PDF)</li>
                                        <li>Primary bottleneck identified</li>
                                        <li>Root cause analysis</li>
                                        <li>Recommended next steps</li>
                                        <li>Matched case studies</li>
                                    </ul>
                                </div>
                                
                                <button type="submit" class="btn" style="width: 100%;">Get My AI Analysis →</button>
                            </form>
                            
                            <p style="text-align: center; margin-top: 15px; font-size: 0.85rem; color: var(--text-muted);">
                                We respect your privacy. No spam. Unsubscribe anytime.
                            </p>
                        </div>

                        <!-- Loading Screen (NEW) -->
                        <div id="loading-screen" class="card" style="background: white; display: none; text-align: center; padding: 60px 30px;">
                            <div style="margin-bottom: 30px;">
                                <div style="width: 60px; height: 60px; border: 4px solid var(--bg-offwhite); border-top: 4px solid var(--accent-navy); border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto;"></div>
                            </div>
                            <h3 style="margin: 0 0 15px 0;">AI Analysis in Progress...</h3>
                            <p style="margin: 0; color: var(--text-muted);" id="loading-message">Analyzing your responses against 25 years of case patterns...</p>
                        </div>

                        <!-- Results Screen (Enhanced with AI) -->
                        <div id="results-screen" class="card" style="background: white; display: none;">
                            <div style="text-align: center; margin-bottom: 40px;">
                                <h2 style="margin: 0 0 10px 0; color: var(--accent-navy);">Your Personalized Diagnostic Report</h2>
                                <p style="margin: 0; color: var(--text-muted);">AI-powered analysis delivered to your inbox</p>
                            </div>
                            
                            <div id="results-content"></div>
                            
                            <div style="background: var(--accent-navy); color: white; padding: 30px; border-radius: 8px; margin-top: 40px; text-align: center;">
                                <h3 style="color: white; margin-top: 0;">Ready to Fix What's Broken?</h3>
                                <p style="color: rgba(255,255,255,0.9); margin-bottom: 25px;">
                                    Book a 30-minute debrief call. We'll walk through your results and recommend the best path forward.
                                </p>
                                <a href="https://calendly.com/periafmalayappa" target="_blank" class="btn" style="background: var(--accent-gold); color: white;">Book Free Debrief Call →</a>
                            </div>
                        </div>

                        <!-- Error Screen (NEW) -->
                        <div id="error-screen" class="card" style="background: white; display: none;">
                            <h3 style="margin-top: 0; color: #dc2626;">Oops! Something Went Wrong</h3>
                            <p>We couldn't process your assessment right now. Don't worry—your answers are saved.</p>
                            <p><strong>What you can do:</strong></p>
                            <ul>
                                <li>Try again in a few minutes</li>
                                <li>Or book a call directly and we'll review your assessment together</li>
                            </ul>
                            <div style="display: flex; gap: 15px; margin-top: 30px;">
                                <button onclick="retryAnalysis()" class="btn-outline" style="flex: 1;">Try Again</button>
                                <a href="https://calendly.com/periafmalayappa" target="_blank" class="btn" style="flex: 1; text-align: center;">Book Call Instead →</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <footer>
        <div class="container footer-wrapper">
            <div>
                <div class="logo">KERNORIGIN</div>
                <p style="margin-top: 15px; font-size: 0.9rem; color: var(--text-muted);">
                    Since 2001 (formerly Value Drive Consulting)<br>
                    25 years finding root causes globally.<br>
                    50+ transformations that stick.
                </p>
            </div>
            <div class="footer-links">
                <a href="../index.html">Home</a>
                <a href="../services.html">Services</a>
                <a href="../insights.html">Insights</a>
                <a href="../contact.html">Contact</a>
            </div>
        </div>
        <div class="container" style="padding-top: 20px; border-top: 1px solid var(--border-light); font-size: 0.8rem; color: #999;">
            © 2026 Kernorigin. All rights reserved.
        </div>
    </footer>

    <style>
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>

    <script src="../config.js"></script>
    <script>
        // ASSESSMENT ENGINE - AI-POWERED VERSION
        
        const questions = [
            {
                text: "How clear is your strategic direction?",
                cylinder: "strategy",
                options: [
                    { text: "Crystal clear - everyone aligned on goals", score: 4 },
                    { text: "Mostly clear - some confusion on priorities", score: 3 },
                    { text: "Unclear - different people, different visions", score: 2 },
                    { text: "No clarity - just reacting to problems", score: 1 }
                ]
            },
            {
                text: "How effective are your core operations?",
                cylinder: "operations",
                options: [
                    { text: "Smooth - repeatable processes, consistent quality", score: 4 },
                    { text: "Functional - works but needs improvement", score: 3 },
                    { text: "Chaotic - lots of firefighting", score: 2 },
                    { text: "Broken - constant crises and failures", score: 1 }
                ]
            },
            {
                text: "How would you describe your technology systems?",
                cylinder: "systems",
                options: [
                    { text: "Modern, integrated, scalable", score: 4 },
                    { text: "Functional but dated - needs upgrading", score: 3 },
                    { text: "Fragmented - multiple disconnected tools", score: 2 },
                    { text: "Manual/broken - major tech debt", score: 1 }
                ]
            },
            {
                text: "What's your team engagement level?",
                cylinder: "people",
                options: [
                    { text: "Highly engaged - low turnover, strong culture", score: 4 },
                    { text: "Engaged - some retention issues", score: 3 },
                    { text: "Disengaged - high turnover, morale issues", score: 2 },
                    { text: "Revolving door - can't retain talent", score: 1 }
                ]
            },
            {
                text: "How healthy are your financial metrics?",
                cylinder: "financial",
                options: [
                    { text: "Strong - healthy margins, good cash flow", score: 4 },
                    { text: "Adequate - profitable but tight", score: 3 },
                    { text: "Struggling - low margins, cash concerns", score: 2 },
                    { text: "Crisis - burning cash, survival mode", score: 1 }
                ]
            },
            {
                text: "How differentiated are you in your market?",
                cylinder: "market",
                options: [
                    { text: "Strongly differentiated - clear unique value", score: 4 },
                    { text: "Somewhat differentiated - known for something", score: 3 },
                    { text: "Commoditized - competing mainly on price", score: 2 },
                    { text: "Unknown - struggling for market share", score: 1 }
                ]
            },
            {
                text: "How would you describe your decision-making speed?",
                cylinder: "leadership",
                options: [
                    { text: "Fast - clear accountability, quick execution", score: 4 },
                    { text: "Moderate - some delays but acceptable", score: 3 },
                    { text: "Slow - analysis paralysis common", score: 2 },
                    { text: "Glacial - decisions take months", score: 1 }
                ]
            },
            {
                text: "What's your revenue growth pattern over the last 2 years?",
                cylinder: "financial",
                options: [
                    { text: "Strong growth - 20%+ annually", score: 4 },
                    { text: "Steady growth - 10-20% annually", score: 3 },
                    { text: "Flat or slow - under 10%", score: 2 },
                    { text: "Declining - losing revenue", score: 1 }
                ]
            },
            {
                text: "How do you handle customer feedback and complaints?",
                cylinder: "operations",
                options: [
                    { text: "Systematic - tracked, analyzed, acted upon", score: 4 },
                    { text: "Reactive - we respond but don't track patterns", score: 3 },
                    { text: "Inconsistent - depends who handles it", score: 2 },
                    { text: "Broken - complaints fall through cracks", score: 1 }
                ]
            },
            {
                text: "What's your biggest challenge right now?",
                cylinder: "general",
                options: [
                    { text: "Scaling - systems breaking under growth", score: 0, tag: "growth" },
                    { text: "Stagnation - can't break through plateau", score: 0, tag: "plateau" },
                    { text: "Chaos - too many problems to prioritize", score: 0, tag: "chaos" },
                    { text: "Competition - losing market share", score: 0, tag: "market" }
                ]
            }
        ];

        let currentQuestion = 0;
        let answers = [];
        let userProfile = {};

        // FIXED: Scroll to top on page load and assessment start
        window.addEventListener('load', () => {
            window.scrollTo(0, 0);
            gtag('event', 'page_view', { 'page_title': 'Assessment' });
        });

        function startAssessment() {
            window.scrollTo({top: 0, behavior: 'instant'}); // CRITICAL FIX
            document.getElementById('intro-screen').style.display = 'none';
            document.getElementById('question-screen').style.display = 'block';
            showQuestion(0);
            gtag('event', 'assessment_start', { 'event_category': 'engagement' });
        }

        function showQuestion(index) {
            currentQuestion = index;
            const q = questions[index];
            
            document.getElementById('current-q').textContent = index + 1;
            document.getElementById('progress-bar').style.width = ((index + 1) / questions.length * 100) + '%';
            document.getElementById('question-text').textContent = q.text;
            
            const optionsDiv = document.getElementById('answer-options');
            optionsDiv.innerHTML = '';
            
            q.options.forEach((option, i) => {
                const selected = answers[index] === i;
                const optionDiv = document.createElement('div');
                optionDiv.className = 'card';
                optionDiv.style.cssText = `
                    padding: 20px; 
                    margin-bottom: 15px; 
                    cursor: pointer; 
                    transition: all 0.2s;
                    border: 2px solid ${selected ? 'var(--accent-navy)' : 'var(--border-light)'};
                    background: ${selected ? '#f0f4ff' : 'white'};
                `;
                optionDiv.onclick = () => selectAnswer(i);
                optionDiv.innerHTML = `<p style="margin: 0; font-weight: ${selected ? '600' : '400'};">${option.text}</p>`;
                optionsDiv.appendChild(optionDiv);
            });
            
            document.getElementById('prev-btn').style.display = index > 0 ? 'block' : 'none';
            document.getElementById('next-btn').disabled = answers[index] === undefined;
            document.getElementById('next-btn').textContent = index === questions.length - 1 ? 'Continue to Results →' : 'Next Question →';
        }

        function selectAnswer(optionIndex) {
            answers[currentQuestion] = optionIndex;
            showQuestion(currentQuestion);
        }

        function previousQuestion() {
            if (currentQuestion > 0) {
                showQuestion(currentQuestion - 1);
            }
        }

        function nextQuestion() {
            if (currentQuestion < questions.length - 1) {
                showQuestion(currentQuestion + 1);
            } else {
                showEmailCapture();
            }
        }

        function showEmailCapture() {
            document.getElementById('question-screen').style.display = 'none';
            document.getElementById('email-capture-screen').style.display = 'block';
            window.scrollTo({top: 0, behavior: 'smooth'});
            gtag('event', 'assessment_complete', { 'event_category': 'engagement' });
        }

        async function submitForAnalysis() {
            const submitBtn = document.getElementById('submit-btn');
            const loader = document.getElementById('loader');
            const resultsDiv = document.getElementById('results');
            
            try {
                submitBtn.disabled = true;
                loader.classList.remove('hidden');
                resultsDiv.classList.add('hidden');

                // Use FormData instead of JSON to avoid CORS preflight
                const formData = new FormData();
                formData.append('action', 'analyze_assessment');
                formData.append('apiKey', API_CONFIG.PUBLIC_KEY);
                formData.append('name', assessmentState.name);
                formData.append('email', assessmentState.email);
                formData.append('company', assessmentState.company || '');
                formData.append('answers', JSON.stringify(assessmentState.fullAnswers));
                formData.append('scores', JSON.stringify(assessmentState.cylinderScores));

                const response = await fetch(API_CONFIG.URL, {
                    method: 'POST',
                    body: formData  // Send as FormData, NOT JSON
                });

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const result = await response.json();

                if (result.status === 'success') {
                    displayResults(result);
                } else {
                    throw new Error(result.error || result.message || 'Analysis failed');
                }

            } catch (error) {
                console.error('Assessment error:', error);
                alert('Failed to submit assessment. Please try again or contact support.\n\nError: ' + error.message);
            } finally {
                submitBtn.disabled = false;
                loader.classList.add('hidden');
            }
        }

        function prepareAssessmentData() {
            const formattedAnswers = {};
            const scores = {
                strategy: 0, operations: 0, systems: 0, people: 0,
                financial: 0, market: 0, leadership: 0
            };
            
            answers.forEach((answerIndex, questionIndex) => {
                const q = questions[questionIndex];
                const option = q.options[answerIndex];
                
                if (!formattedAnswers[q.cylinder]) {
                    formattedAnswers[q.cylinder] = [];
                }
                
                formattedAnswers[q.cylinder].push({
                    question: q.text,
                    answer: option.text,
                    score: option.score || 0,
                    tag: option.tag || null
                });
                
                if (q.cylinder !== 'general' && option.score) {
                    scores[q.cylinder] += option.score;
                }
            });
            
            return {
                name: userProfile.name,
                email: userProfile.email,
                company: userProfile.company,
                answers: formattedAnswers,
                scores: scores,
                timestamp: new Date().toISOString()
            };
        }

        function displayResults(result) {
            document.getElementById('loading-screen').style.display = 'none';
            document.getElementById('results-screen').style.display = 'block';
            window.scrollTo({top: 0, behavior: 'smooth'});
            
            const resultsDiv = document.getElementById('results-content');
            
            // If AI analysis is available, use it
            if (result.analysis) {
                resultsDiv.innerHTML = `
                    <div style="background: #f0f9ff; padding: 25px; border-left: 4px solid var(--accent-navy); margin-bottom: 30px;">
                        <p style="margin: 0; font-size: 0.9rem; font-weight: 600; color: var(--accent-navy);">
                            ✓ Analysis complete! Full report emailed to ${userProfile.email}
                        </p>
                    </div>
                    
                    ${result.analysis}
                    
                    <div style="background: #fef9e7; border-left: 4px solid var(--accent-gold); padding: 25px; margin-top: 40px;">
                        <h4 style="margin-top: 0;">Want Deeper Analysis?</h4>
                        <p style="margin-bottom: 20px;">This free assessment gives directional insights. For root cause diagnosis with specific action plans:</p>
                        <div style="display: grid; gap: 15px;">
                            <a href="../services.html#diagnostic" class="btn-outline">Institutional Diagnostic (₹25K) - Full 7-Cylinder Analysis →</a>
                            <a href="../systems-diagnostic.html" class="btn-outline">Systems Diagnostic (₹35K) - Ops & Process Deep Dive →</a>
                        </div>
                    </div>
                `;
            } else {
                // Fallback if AI analysis isn't available yet
                resultsDiv.innerHTML = `
                    <div style="background: var(--accent-gold); color: white; padding: 25px; border-radius: 8px; margin-bottom: 30px; text-align: center;">
                        <h3 style="color: white; margin: 0;">Report Sent!</h3>
                        <p style="margin: 10px 0 0 0; color: rgba(255,255,255,0.9);">
                            Check your email: <strong>${userProfile.email}</strong>
                        </p>
                    </div>
                    <p>Your detailed analysis is on its way. If you don't see it within 5 minutes, check your spam folder.</p>
                    <p><strong>In the meantime:</strong></p>
                    <ul>
                        <li>Book a free 30-min debrief call to discuss your results</li>
                        <li>Explore our services for deeper diagnostic support</li>
                        <li>Read case studies of similar transformations</li>
                    </ul>
                `;
            }
        }

        function showError() {
            document.getElementById('loading-screen').style.display = 'none';
            document.getElementById('error-screen').style.display = 'block';
            window.scrollTo({top: 0, behavior: 'smooth'});
        }

        function retryAnalysis() {
            document.getElementById('error-screen').style.display = 'none';
            document.getElementById('email-capture-screen').style.display = 'block';
        }
    </script>
    <script src="../mobile-menu.js"></script>
</body>
</html>
