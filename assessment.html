<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Free Business Assessment | Kernorigin</title>
    <meta name="description" content="10-minute AI-powered assessment reveals where your business is stuck. Get personalized recommendations based on 25 years of diagnostic experience.">
    <link rel="stylesheet" href="style.css">
    <script src="translations.js"></script>
    
    <!-- Razorpay Integration -->
    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
    
    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-ZDL25WXPVP"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-ZDL25WXPVP');
    </script>
    
    <style>
        /* ============================================
           ENHANCED QUESTION UI/UX STYLES
           Clean, spacious, professional design
           ============================================ */
        
        /* Progress Section - Cleaner Design */
        .progress-wrapper {
            background: white;
            padding: 30px;
            border-radius: 12px;
            margin-bottom: 40px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .progress-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 18px;
        }
        
        .progress-label {
            font-size: 0.95rem;
            color: var(--text-muted);
            font-weight: 500;
        }
        
        .progress-count {
            font-size: 1.15rem;
            font-weight: 700;
            color: var(--accent-navy);
        }
        
        .progress-bar-container {
            background: #e5e7eb;
            height: 8px;
            border-radius: 4px;
            overflow: hidden;
        }
        
        .progress-bar-fill {
            background: linear-gradient(90deg, var(--accent-navy), var(--accent-gold));
            height: 100%;
            transition: width 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            border-radius: 4px;
        }
        
        /* Question Card - More Breathing Room */
        .question-card {
            background: white;
            padding: 60px 50px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            margin-bottom: 30px;
            min-height: 450px;
            display: flex;
            flex-direction: column;
        }
        
        .question-title {
            font-size: 1.6rem;
            font-weight: 600;
            color: var(--text-primary);
            line-height: 1.5;
            margin: 0 0 50px 0;
            text-align: center;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
        }
        
        /* Answer Options - Card-Based Design */
        .options-container {
            display: flex;
            flex-direction: column;
            gap: 16px;
            margin-bottom: auto;
        }
        
        .option-card {
            background: white;
            border: 2px solid #e5e7eb;
            padding: 24px 28px;
            border-radius: 10px;
            text-align: left;
            font-size: 1.05rem;
            line-height: 1.6;
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            width: 100%;
            display: block;
        }
        
        .option-card:hover {
            border-color: var(--accent-navy);
            background: #f8fafc;
            transform: translateY(-3px);
            box-shadow: 0 6px 16px rgba(0,0,0,0.12);
        }
        
        .option-card.selected {
            border-color: var(--accent-navy);
            background: linear-gradient(135deg, rgba(30, 58, 138, 0.06) 0%, rgba(59, 130, 246, 0.06) 100%);
            font-weight: 500;
            box-shadow: 0 4px 12px rgba(30, 58, 138, 0.15);
        }
        
        .option-card.selected::after {
            content: '‚úì';
            position: absolute;
            right: 24px;
            top: 50%;
            transform: translateY(-50%);
            width: 32px;
            height: 32px;
            background: var(--accent-navy);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1rem;
        }
        
        .option-card:active {
            transform: scale(0.98);
        }
        
        /* Navigation Buttons - Enhanced Spacing */
        .nav-buttons {
            display: flex;
            gap: 16px;
            margin-top: 50px;
            padding-top: 30px;
            border-top: 1px solid #f1f5f9;
        }
        
        .btn-secondary {
            background: white;
            border: 2px solid var(--accent-navy);
            color: var(--accent-navy);
            padding: 16px 32px;
            border-radius: 8px;
            font-size: 1.05rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            flex: 1;
        }
        
        .btn-secondary:hover {
            background: var(--accent-navy);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(30, 58, 138, 0.25);
        }
        
        .btn-primary {
            background: var(--accent-navy);
            color: white;
            padding: 16px 32px;
            border-radius: 8px;
            font-size: 1.05rem;
            font-weight: 600;
            border: 2px solid var(--accent-navy);
            cursor: pointer;
            transition: all 0.2s ease;
            flex: 2;
        }
        
        .btn-primary:hover:not(:disabled) {
            background: #1e3a8a;
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(30, 58, 138, 0.3);
        }
        
        .btn-primary:disabled {
            background: #e5e7eb;
            border-color: #e5e7eb;
            color: #9ca3af;
            cursor: not-allowed;
            transform: none;
        }

        /* Language Selector in Nav */
        .lang-select {
            padding: 6px 12px;
            font-size: 0.9rem;
            font-weight: 600;
            border: 2px solid var(--accent-navy);
            border-radius: 6px;
            background: white;
            color: var(--accent-navy);
            cursor: pointer;
        }
        
        /* Mobile Responsiveness */
        @media (max-width: 768px) {
            .question-card {
                padding: 40px 24px;
                min-height: auto;
            }
            
            .question-title {
                font-size: 1.35rem;
                margin-bottom: 35px;
            }
            
            .option-card {
                padding: 20px 24px;
                font-size: 1rem;
            }
            
            .option-card.selected::after {
                width: 28px;
                height: 28px;
                font-size: 0.9rem;
            }
            
            .nav-buttons {
                flex-direction: column;
                gap: 12px;
            }
            
            .btn-primary, .btn-secondary {
                width: 100%;
                padding: 14px 24px;
            }
            
            .progress-wrapper {
                padding: 20px;
            }
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 4px solid #f3f4f6;
            border-top: 4px solid var(--accent-navy);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }
    </style>
</head>
<body>
    <header>
        <div class="container nav-wrapper">
            <a href="index.html" class="logo" id="header-logo">Kernorigin</a>
            <nav>
                <ul>
                    <li><a href="index.html">Home</a></li>
                    <li><a href="how-we-think.html">How We Think</a></li>
                    <li><a href="how-we-work.html">How We Work</a></li>
                    <li><a href="services.html">Services</a></li>
                    <li><a href="impact.html">Impact</a></li>
                    <li><a href="team.html">Team</a></li>
                    <li><a href="insights.html">Insights</a></li>
                    <li><a href="contact.html">Contact</a></li>
                    <li class="lang-item">
                        <select id="language-selector" class="lang-select" onchange="switchLanguage(this.value)">
                            <option value="en">üá¨üáß English</option>
                            <option value="hi">üáÆüá≥ ‡§π‡§ø‡§®‡•ç‡§¶‡•Ä</option>
                            <option value="kn">üáÆüá≥ ‡≤ï‡≤®‡≥ç‡≤®‡≤°</option>
                        </select>
                    </li>
                </ul>
            </nav>
        </div>
    </header>

    <main>
        <section class="section-padding" style="background: var(--bg-offwhite); min-height: 100vh;">
            <div class="container">
                <div class="readable-column">
                    <div class="text-center" style="margin-bottom: 50px;">
                        <span class="eyebrow" id="header-eyebrow">AI-Powered Diagnostic Tool</span>
                        <h1 id="main-title">Where Is Your Business Stuck?</h1>
                        <p style="font-size: 1.1rem; max-width: 650px; margin: 20px auto 0 auto;">
                            Answer 10 questions. Get personalized AI analysis based on our Seven Cylinders Framework‚Ñ¢. Takes 5 minutes.
                        </p>
                    </div>

                    <div id="assessment-container">
                        <!-- Introduction Screen -->
                        <div id="intro-screen" class="card" style="background: white;">
                            <h3 style="margin-top: 0;">How This AI Assessment Works</h3>
                            <p>This assessment uses AI to evaluate your organization across seven critical dimensions:</p>
                            <div class="grid-2" style="gap: 15px; margin: 25px 0;">
                                <div style="padding: 15px; background: var(--bg-offwhite); border-radius: 4px;">
                                    <p style="margin: 0; font-weight: 600;">1. Strategic Clarity</p>
                                </div>
                                <div style="padding: 15px; background: var(--bg-offwhite); border-radius: 4px;">
                                    <p style="margin: 0; font-weight: 600;">2. Operational Excellence</p>
                                </div>
                                <div style="padding: 15px; background: var(--bg-offwhite); border-radius: 4px;">
                                    <p style="margin: 0; font-weight: 600;">3. People & Culture</p>
                                </div>
                                <div style="padding: 15px; background: var(--bg-offwhite); border-radius: 4px;">
                                    <p style="margin: 0; font-weight: 600;">4. Systems & Process</p>
                                </div>
                                <div style="padding: 15px; background: var(--bg-offwhite); border-radius: 4px;">
                                    <p style="margin: 0; font-weight: 600;">5. Financial Health</p>
                                </div>
                                <div style="padding: 15px; background: var(--bg-offwhite); border-radius: 4px;">
                                    <p style="margin: 0; font-weight: 600;">6. Market Position</p>
                                </div>
                            </div>
                            <div style="padding: 15px; background: var(--bg-offwhite); border-radius: 4px; margin-bottom: 30px;">
                                <p style="margin: 0; font-weight: 600; text-align: center;">7. Leadership Capacity</p>
                            </div>
                            
                            <div id="partner-banner" style="background: #f0f9ff; border-left: 4px solid var(--accent-navy); padding: 20px; margin-bottom: 30px; display: none;">
                                <p style="margin: 0; font-weight: 600; color: var(--accent-navy);" id="partner-message"></p>
                            </div>
                            
                            <div style="background: #fef9e7; border-left: 4px solid var(--accent-gold); padding: 20px; margin-bottom: 30px;">
                                <p style="margin: 0;"><strong>Your AI-powered analysis will reveal:</strong></p>
                                <ul style="margin: 10px 0 0 0; padding-left: 20px;">
                                    <li>Your primary bottleneck (what's actually stuck)</li>
                                    <li>Root cause vs. symptoms (why fixes haven't worked)</li>
                                    <li>Matched case studies (similar transformations)</li>
                                    <li id="intro-benefit">Specific next steps (diagnostic, workshop, or strategy)</li>
                                </ul>
                            </div>

                            <button onclick="startAssessment()" class="btn" id="start-btn" style="width: 100%; padding: 18px;">Begin AI Assessment ‚Üí</button>
                            
                            <p style="text-align: center; margin-top: 20px; font-size: 0.9rem; color: var(--text-muted);">
                                No signup required. Results delivered instantly + via email.
                            </p>
                        </div>

                        <!-- Questions Screen - IMPROVED UI/UX -->
                        <div id="question-screen" style="display: none;">
                            <!-- Progress Indicator -->
                            <div class="progress-wrapper">
                                <div class="progress-header">
                                    <span class="progress-label">Question Progress</span>
                                    <span class="progress-count"><span id="current-q">1</span> of 10</span>
                                </div>
                                <div class="progress-bar-container">
                                    <div id="progress-bar" class="progress-bar-fill" style="width: 10%;"></div>
                                </div>
                            </div>

                            <!-- Question Card -->
                            <div class="question-card">
                                <h3 id="question-text" class="question-title">Question text here</h3>
                                
                                <div id="answer-options" class="options-container"></div>

                                <div class="nav-buttons">
                                    <button onclick="previousQuestion()" id="prev-btn" class="btn-secondary" style="display: none;">‚Üê Previous</button>
                                    <button onclick="nextQuestion()" id="next-btn" class="btn-primary" disabled>Next Question ‚Üí</button>
                                </div>
                            </div>
                        </div>

                        <!-- Email Capture Screen -->
                        <div id="email-capture-screen" class="card" style="background: white; display: none;">
                            <h3>Get Your Personalized Diagnostic Report</h3>
                            <p style="color: var(--text-muted); margin-bottom: 30px;">
                                Enter your details to receive a comprehensive AI-powered analysis based on your responses.
                            </p>
                            
                            <form id="email-form" onsubmit="submitAssessment(event)">
                                <div style="margin-bottom: 20px;">
                                    <label style="display: block; font-weight: 600; margin-bottom: 8px;">Your Name *</label>
                                    <input type="text" id="user-name" required placeholder="Full name" 
                                           style="width: 100%; padding: 12px; border: 1px solid #e5e7eb; border-radius: 6px; font-size: 1rem;">
                                </div>
                                
                                <div style="margin-bottom: 20px;">
                                    <label style="display: block; font-weight: 600; margin-bottom: 8px;">Email Address *</label>
                                    <input type="email" id="user-email" required placeholder="name@company.com"
                                           style="width: 100%; padding: 12px; border: 1px solid #e5e7eb; border-radius: 6px; font-size: 1rem;">
                                </div>
                                
                                <div style="margin-bottom: 30px;">
                                    <label style="display: block; font-weight: 600; margin-bottom: 8px;">Company Name (Optional)</label>
                                    <input type="text" id="user-company" placeholder="Your company"
                                           style="width: 100%; padding: 12px; border: 1px solid #e5e7eb; border-radius: 6px; font-size: 1rem;">
                                </div>

                                <div id="coupon-section" style="display: none; background: #f0fdf4; border: 2px solid #10b981; padding: 20px; border-radius: 8px; margin-bottom: 25px;">
                                    <p style="margin: 0 0 10px 0; font-weight: 600; color: #059669;">‚úì Partner Coupon Applied</p>
                                    <input type="text" id="coupon-code" readonly
                                           style="width: 100%; padding: 10px; border: 1px solid #10b981; border-radius: 4px; background: white; font-family: monospace;">
                                    <p style="margin: 10px 0 0 0; font-size: 0.9rem; color: #059669;">Full diagnostic included (‚Çπ24,997 value)</p>
                                </div>
                                <div style="margin-bottom: 20px;">
                                <label style="display: block; font-weight: 600; margin-bottom: 8px;">Industry / Sector *</label>
                                <select id="user-industry" required
                                        style="width: 100%; padding: 12px; border: 1px solid #e5e7eb; border-radius: 6px; font-size: 1rem; background: white; color: #1a1a1a;">
                                    <option value="" disabled selected>Select your industry...</option>
                                    <option value="Professional Services">Professional Services (Agency, Consulting)</option>
                                    <option value="Manufacturing">Manufacturing / Industrial</option>
                                    <option value="Retail">Retail / Trading / E-commerce</option>
                                    <option value="Technology">Technology / SaaS</option>
                                    <option value="Healthcare">Healthcare / Medical</option>
                                    <option value="Restaurant">Restaurant / Hospitality</option>
                                    <option value="General">Other</option>
                                </select>
                                </div>
                                <button type="submit" class="btn" style="width: 100%; padding: 16px;">
                                    Get My Free Report ‚Üí
                                </button>
                            </form>
                            
                            <p style="text-align: center; margin-top: 20px; font-size: 0.85rem; color: var(--text-muted);">
                                üîí Your data is private and secure. We'll never spam you.
                            </p>
                        </div>

                        <!-- Loading Screen -->
                        <div id="loading-screen" class="card" style="background: white; display: none; text-align: center; padding: 60px 30px;">
                            <div class="loading-spinner" style="margin-bottom: 30px;"></div>
                            <h3 style="margin-bottom: 15px;">Analyzing Your Business...</h3>
                            <p id="loading-message" style="color: var(--text-muted); font-size: 1.05rem;">
                                Our AI is evaluating your responses across all seven cylinders...
                            </p>
                        </div>

                        <!-- Results Screen -->
                        <div id="results-screen" class="card" style="background: white; display: none;">
                            <div style="text-align: center; margin-bottom: 40px;">
                                <div style="display: inline-block; background: #10b981; color: white; padding: 12px 24px; border-radius: 50px; margin-bottom: 20px;">
                                    <span id="analysis-complete-badge" style="font-size: 1.1rem; font-weight: 600;">‚úì Analysis Complete</span>
                                </div>
                                <h2 id="results-title" style="margin: 0; color: var(--accent-navy);">Your Diagnostic Report</h2>
                                <p id="results-subtitle" style="color: var(--text-muted); margin-top: 10px;">A personalized analysis has been sent to your email</p>
                            </div>
                            
                            <div id="results-content"></div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <footer style="background: var(--bg-offwhite); padding: 50px 0; border-top: 1px solid #e5e7eb;">
        <div class="container" style="text-align: center;">
            <p style="margin: 0; font-size: 0.9rem; color: var(--text-muted);">
                ¬© 2026 <span id="footer-logo">Kernorigin</span>. All rights reserved.
            </p>
        </div>
    </footer>

    <script src="config.js"></script>
    <script src="mobile-menu.js"></script>
    
    <script>
        // ============================================
        // ‚úÖ MULTILINGUAL SYSTEM - INITIALIZATION
        // ============================================
        
        let currentLanguage = 'en';
        let t = TRANSLATIONS.en;  // Current translation object
        
        // Detect language from URL parameter
        const urlParams = new URLSearchParams(window.location.search);
        const langParam = urlParams.get('lang');
        if (langParam && TRANSLATIONS[langParam]) {
            currentLanguage = langParam;
            t = TRANSLATIONS[langParam];
        }
        
        // ‚úÖ BULLETPROOF switchLanguage - sets currentLanguage FIRST
        function switchLanguage(lang) {
            // CRITICAL: Always update currentLanguage, even if translations fail
            // This ensures backend gets the right language for report generation
            currentLanguage = lang;
            
            // Update translations object (if available)
            if (typeof TRANSLATIONS !== 'undefined' && TRANSLATIONS[lang]) {
                t = TRANSLATIONS[lang];
                console.log('‚úÖ UI translations loaded for:', lang);
            } else {
                // Fallback to English UI if translations not available
                t = (typeof TRANSLATIONS !== 'undefined' && TRANSLATIONS['en']) ? TRANSLATIONS['en'] : {};
                console.warn('‚ö†Ô∏è No UI strings for', lang, '- UI stays English, but report will be in', lang);
            }
            
            // Update selector
            const selector = document.getElementById('language-selector');
            if (selector) selector.value = lang;
            
            // Update page text
            updatePageLanguage();
            
            // Update URL
            try {
                const url = new URL(window.location);
                url.searchParams.set('lang', lang);
                window.history.pushState({}, '', url);
            } catch (e) {
                console.warn('Could not update URL:', e);
            }
            
            // Re-render current question
            if (currentQuestion >= 0 && currentQuestion < questions.length) {
                showQuestion(currentQuestion);
            }
            
            console.log('üìå currentLanguage set to:', currentLanguage);
        }
        
        // ‚úÖ Update Page Language Function
        function updatePageLanguage() {
            // Update main title
            const titleMap = {
                en: "Where Is Your Business Stuck?",
                hi: "‡§Ü‡§™‡§ï‡§æ ‡§µ‡•ç‡§Ø‡§µ‡§∏‡§æ‡§Ø ‡§ï‡§π‡§æ‡§Å ‡§∞‡•Å‡§ï‡§æ ‡§π‡•Å‡§Ü ‡§π‡•à?",
                kn: "‡≤®‡≤ø‡≤Æ‡≥ç‡≤Æ ‡≤µ‡≥ç‡≤Ø‡≤æ‡≤™‡≤æ‡≤∞ ‡≤é‡≤≤‡≥ç‡≤≤‡≤ø ‡≤∏‡≤ø‡≤≤‡≥Å‡≤ï‡≤ø‡≤ï‡≥ä‡≤Ç‡≤°‡≤ø‡≤¶‡≥Ü?"
            };
            document.getElementById('main-title').textContent = titleMap[currentLanguage] || titleMap.en;
            
            // Update start button
            const btnMap = {
                en: "Begin AI Assessment ‚Üí",
                hi: "AI ‡§Æ‡•Ç‡§≤‡•ç‡§Ø‡§æ‡§Ç‡§ï‡§® ‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡•á‡§Ç ‚Üí",
                kn: "AI ‡≤Æ‡≥å‡≤≤‡≥ç‡≤Ø‡≤Æ‡≤æ‡≤™‡≤®‡≤µ‡≤®‡≥ç‡≤®‡≥Å ‡≤™‡≥ç‡≤∞‡≤æ‡≤∞‡≤Ç‡≤≠‡≤ø‡≤∏‡≤ø ‚Üí"
            };
            const startBtn = document.getElementById('start-btn');
            if (startBtn) {
                startBtn.textContent = btnMap[currentLanguage] || btnMap.en;
            }
        }
        
        // Initialize language on page load
        window.addEventListener('DOMContentLoaded', function() {
            document.getElementById('language-selector').value = currentLanguage;
            updatePageLanguage();
        });

        // ============================================
        // 1. PARTNER SYSTEM INIT
        // ============================================
        
        const partnerId = urlParams.get('partner') || '';
        const prefillCoupon = urlParams.get('coupon') || '';
        
        let partnerBranding = null;
        let assessmentState = {
            mode: 'free', // 'free', 'coupon', or 'paid'
            partnerId: partnerId,
            couponCode: prefillCoupon,
            name: '',
            email: '',
            company: '',
            fullAnswers: {},
            cylinderScores: {}
        };

        if (partnerId) {
            loadPartnerBranding(partnerId);
        }

        if (prefillCoupon) {
            assessmentState.mode = 'coupon';
            assessmentState.couponCode = prefillCoupon;
        }

        async function loadPartnerBranding(partnerId) {
            try {
                const response = await fetch(`${API_CONFIG.URL}?action=get_partner_branding&partnerId=${partnerId}`);
                const result = await response.json();
                
                if (result.status === 'success' && result.partner) {
                    partnerBranding = result.partner;
                    assessmentState.mode = 'coupon'; // Partner link = coupon mode
                    applyPartnerBranding(result.partner);
                }
            } catch (error) {
                console.error('Failed to load partner branding:', error);
            }
        }
        
        function applyPartnerBranding(partner) {
            // Update page branding
            document.title = `Free Business Assessment | ${partner.branding.displayName}`;
            
            // Update logos
            document.getElementById('header-logo').textContent = partner.branding.displayName;
            document.getElementById('footer-logo').textContent = `${partner.branding.displayName} √ó KERNORIGIN`;
            
            // Apply brand colors
            document.documentElement.style.setProperty('--accent-navy', partner.branding.primaryColor);
            document.documentElement.style.setProperty('--accent-gold', partner.branding.secondaryColor);
            
            // Update eyebrow
            document.getElementById('header-eyebrow').textContent = `Complimentary Diagnostic via ${partner.name}`;
            
            // Show partner banner
            const banner = document.getElementById('partner-banner');
            const message = document.getElementById('partner-message');
            banner.style.display = 'block';
            message.textContent = `‚úì You're receiving a complimentary full diagnostic courtesy of ${partner.name} (‚Çπ24,997 value)`;
            
            // Update intro benefit
            document.getElementById('intro-benefit').innerHTML = `<strong>FREE 35-page comprehensive report</strong> (normally ‚Çπ24,997)`;
        }
        
        // ============================================
        // 2. ASSESSMENT QUESTIONS
        // ============================================
        
        const questions = [
            {
                text: "How clear is your strategic direction?",
                cylinder: "strategy",
                options: [
                    { text: "Crystal clear - everyone aligned on goals", score: 4 },
                    { text: "Mostly clear - some confusion on priorities", score: 3 },
                    { text: "Unclear - different people, different visions", score: 2 },
                    { text: "No clarity - just reacting to problems", score: 1 }
                ]
            },
            {
                text: "How effective are your core operations?",
                cylinder: "operations",
                options: [
                    { text: "Smooth - repeatable processes, consistent quality", score: 4 },
                    { text: "Functional - works but needs improvement", score: 3 },
                    { text: "Chaotic - lots of firefighting", score: 2 },
                    { text: "Broken - constant crises and failures", score: 1 }
                ]
            },
            {
                text: "How would you describe your technology systems?",
                cylinder: "systems",
                options: [
                    { text: "Modern, integrated, reliable", score: 4 },
                    { text: "Adequate but aging or disconnected", score: 3 },
                    { text: "Outdated or manual workarounds common", score: 2 },
                    { text: "Broken or non-existent systems", score: 1 }
                ]
            },
            {
                text: "How would you rate your team's capability?",
                cylinder: "people",
                options: [
                    { text: "High performers - skilled and engaged", score: 4 },
                    { text: "Solid team - some skill gaps", score: 3 },
                    { text: "Struggling - high turnover or low morale", score: 2 },
                    { text: "Critical capability gaps holding us back", score: 1 }
                ]
            },
            {
                text: "How healthy is your cash flow?",
                cylinder: "financial",
                options: [
                    { text: "Strong - positive and growing", score: 4 },
                    { text: "Stable - managing but tight", score: 3 },
                    { text: "Stressed - frequent cash crunches", score: 2 },
                    { text: "Critical - survival mode", score: 1 }
                ]
            },
            {
                text: "How strong is your market position?",
                cylinder: "market",
                options: [
                    { text: "Market leader - clear differentiation", score: 4 },
                    { text: "Competitive - holding our own", score: 3 },
                    { text: "Struggling - losing ground", score: 2 },
                    { text: "Unclear positioning or commoditized", score: 1 }
                ]
            },
            {
                text: "How effective is your leadership team?",
                cylinder: "leadership",
                options: [
                    { text: "Strong - clear vision, good decisions", score: 4 },
                    { text: "Functional - gets things done", score: 3 },
                    { text: "Weak - inconsistent or unclear", score: 2 },
                    { text: "Dysfunctional - major leadership gaps", score: 1 }
                ]
            },
            {
                text: "How scalable are your current processes?",
                cylinder: "operations",
                options: [
                    { text: "Highly scalable - documented and automated", score: 4 },
                    { text: "Can scale with some effort", score: 3 },
                    { text: "Barely keeping up with current volume", score: 2 },
                    { text: "Breaking under current load", score: 1 }
                ]
            },
            {
                text: "How well do you understand your customer needs?",
                cylinder: "market",
                options: [
                    { text: "Deep understanding - backed by data", score: 4 },
                    { text: "Good understanding - some gaps", score: 3 },
                    { text: "Surface level - mostly assumptions", score: 2 },
                    { text: "Unclear - guessing or outdated info", score: 1 }
                ]
            },
            {
                text: "How predictable is your revenue?",
                cylinder: "financial",
                options: [
                    { text: "Very predictable - strong pipelines", score: 4 },
                    { text: "Somewhat predictable - some volatility", score: 3 },
                    { text: "Unpredictable - month to month uncertainty", score: 2 },
                    { text: "Highly volatile - survival mode", score: 1 }
                ]
            }
        ];

        let currentQuestion = 0;
        let answers = [];
        let userProfile = {};

        // ============================================
        // 3. IMPROVED SCROLL LOGIC (Keeps focus on questions)
        // ============================================
        
        function scrollToAssessment() {
            const container = document.getElementById('assessment-container');
            if (!container) return;

            const header = document.querySelector('header');
            const headerHeight = header ? header.offsetHeight : 0;
            
            const elementPosition = container.getBoundingClientRect().top + window.scrollY;
            const offsetPosition = elementPosition - headerHeight - 20;

            window.scrollTo({
                top: offsetPosition,
                behavior: "smooth"
            });
        }

        // ============================================
        // 4. ASSESSMENT FLOW
        // ============================================

        function startAssessment() {
            document.getElementById('intro-screen').style.display = 'none';
            document.getElementById('question-screen').style.display = 'block';
            scrollToAssessment();
            showQuestion(0);
            
            gtag('event', 'assessment_started', { 
                'event_category': 'engagement',
                'event_label': assessmentState.mode
            });
        }

        function showQuestion(index) {
            currentQuestion = index;
            const q = questions[index];
            
            document.getElementById('current-q').textContent = index + 1;
            document.getElementById('progress-bar').style.width = ((index + 1) / questions.length * 100) + '%';

            // ‚úÖ MULTILINGUAL: Use translation if available, fallback to English
            const questionKey = 'q' + (index + 1);
            const questionText = (t && t[questionKey]) ? t[questionKey] : q.text;
            document.getElementById('question-text').textContent = questionText;
            
            const optionsDiv = document.getElementById('answer-options');
            optionsDiv.innerHTML = '';
            
            q.options.forEach((option, i) => {
                const btn = document.createElement('button');
                btn.className = 'option-card';

                // ‚úÖ MULTILINGUAL: Use translation if available, fallback to English
                const optionKey = 'q' + (index + 1) + '_opt' + (i + 1);
                const optionText = (t && t[optionKey]) ? t[optionKey] : option.text;
                btn.textContent = optionText;
                
                btn.onclick = () => selectAnswer(i);
                
                if (answers[index] === i) {
                    btn.classList.add('selected');
                }
                
                optionsDiv.appendChild(btn);
            });
            
            document.getElementById('prev-btn').style.display = index > 0 ? 'block' : 'none';
            document.getElementById('next-btn').disabled = answers[index] === undefined;
            document.getElementById('next-btn').textContent = index === questions.length - 1 ? 'See Results ‚Üí' : 'Next Question ‚Üí';
            
            // Smooth scroll with timeout to let DOM paint
            setTimeout(scrollToAssessment, 50);
        }

        function selectAnswer(optionIndex) {
            answers[currentQuestion] = optionIndex;
            
            document.querySelectorAll('.option-card').forEach((btn, idx) => {
                btn.classList.toggle('selected', idx === optionIndex);
            });
            
            document.getElementById('next-btn').disabled = false;
        }

        function previousQuestion() {
            if (currentQuestion > 0) {
                showQuestion(currentQuestion - 1);
            }
        }

        function nextQuestion() {
            if (currentQuestion < questions.length - 1) {
                showQuestion(currentQuestion + 1);
            } else {
                finishAssessment();
            }
        }

        function finishAssessment() {
            document.getElementById('question-screen').style.display = 'none';
            document.getElementById('email-capture-screen').style.display = 'block';
            
            // If partner coupon mode, show coupon section
            if (assessmentState.mode === 'coupon' && assessmentState.couponCode) {
                document.getElementById('coupon-section').style.display = 'block';
                document.getElementById('coupon-code').value = assessmentState.couponCode;
            }
            
            scrollToAssessment();
            
            gtag('event', 'assessment_completed', { 
                'event_category': 'engagement',
                'event_label': 'all_questions_answered'
            });
        }

        // ============================================
        // 5. SUBMIT ASSESSMENT
        // ============================================

        async function submitAssessment(e) {
            e.preventDefault();
            
            document.getElementById('email-capture-screen').style.display = 'none';
            document.getElementById('loading-screen').style.display = 'block';
            scrollToAssessment();
            
            // Collect user data
            assessmentState.name = document.getElementById('user-name').value;
            assessmentState.email = document.getElementById('user-email').value;
            assessmentState.company = document.getElementById('user-company').value || 'Not specified';
            
            // Format answers by cylinder
            const formattedAnswers = {};
            const scores = {
                strategy: 0,
                operations: 0,
                systems: 0,
                people: 0,
                financial: 0,
                market: 0,
                leadership: 0
            };
            
            // ‚úÖ MULTILINGUAL: Send translated answer text to backend
            answers.forEach((answerIndex, questionIndex) => {
                const q = questions[questionIndex];
                const selectedOption = q.options[answerIndex];
                
                if (!formattedAnswers[q.cylinder]) {
                    formattedAnswers[q.cylinder] = [];
                }
                
                // Use translated question/answer text if available for better AI context
                const questionKey = 'q' + (questionIndex + 1);
                const optionKey = 'q' + (questionIndex + 1) + '_opt' + (answerIndex + 1);
                const questionText = (t && t[questionKey]) ? t[questionKey] : q.text;
                const answerText = (t && t[optionKey]) ? t[optionKey] : selectedOption.text;
                
                formattedAnswers[q.cylinder].push({
                    question: questionText,   // ‚úÖ Translated if available
                    answer: answerText,       // ‚úÖ Translated if available
                    score: selectedOption.score
                });
                
                if (q.cylinder !== 'general') {
                    scores[q.cylinder] += selectedOption.score;
                }
            });

            try {
                // Determine endpoint based on mode
                let action = 'analyze_assessment';
                if (assessmentState.mode === 'coupon') {
                    action = 'analyze_assessment_partner';
                }
                
                const formData = new FormData();
                formData.append('action', action);
                formData.append('apiKey', API_CONFIG.PUBLIC_KEY);
                formData.append('name', assessmentState.name);
                formData.append('email', assessmentState.email);
                formData.append('company', assessmentState.company);
                const industry = document.getElementById('user-industry').value;
                formData.append('industry', industry);
                
                // ‚úÖ MULTILINGUAL: Read language from selector + global (defensive)
                const langSelector = document.getElementById('language-selector');
                const submitLanguage = (langSelector && langSelector.value) || currentLanguage || 'en';
                formData.append('language', submitLanguage);
                console.log('üì§ Submitting assessment with language:', submitLanguage);
                console.log('   currentLanguage global:', currentLanguage);
                console.log('   Selector value:', langSelector ? langSelector.value : 'N/A');
                
                formData.append('answers', JSON.stringify(formattedAnswers));
                formData.append('scores', JSON.stringify(scores));
                
                if (assessmentState.mode === 'coupon') {
                    formData.append('couponCode', assessmentState.couponCode);
                }

                const response = await fetch(API_CONFIG.URL, {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();
                
                if (result.status === 'error') {
                    throw new Error(result.error || result.message);
                }
                
                displayResults(result);
                
                gtag('event', 'assessment_submitted', { 
                    'event_category': 'conversion',
                    'event_label': assessmentState.mode,
                    'value': assessmentState.mode === 'coupon' ? 24997 : 0
                });
                
            } catch (error) {
                console.error('Assessment submission error:', error);
                document.getElementById('loading-screen').style.display = 'none';
                alert('Failed to generate analysis. Please try again or contact support.');
            }
        }

        // ‚úÖ MULTILINGUAL displayResults function
        function displayResults(result) {
            document.getElementById('loading-screen').style.display = 'none';
            document.getElementById('results-screen').style.display = 'block';
            scrollToAssessment();
            
            // ‚úÖ Update static result screen headers with translations
            const badge = document.getElementById('analysis-complete-badge');
            const title = document.getElementById('results-title');
            const subtitle = document.getElementById('results-subtitle');
            
            const badgeText = {
                en: '‚úì Analysis Complete',
                hi: '‚úì ‡§µ‡§ø‡§∂‡•ç‡§≤‡•á‡§∑‡§£ ‡§™‡•Ç‡§∞‡•ç‡§£',
                kn: '‚úì ‡≤µ‡≤ø‡≤∂‡≥ç‡≤≤‡≥á‡≤∑‡≤£‡≥Ü ‡≤™‡≥Ç‡≤∞‡≥ç‡≤£‡≤ó‡≥ä‡≤Ç‡≤°‡≤ø‡≤¶‡≥Ü'
            };
            const titleText = {
                en: 'Your Diagnostic Report',
                hi: '‡§Ü‡§™‡§ï‡•Ä ‡§®‡§ø‡§¶‡§æ‡§® ‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü',
                kn: '‡≤®‡≤ø‡≤Æ‡≥ç‡≤Æ ‡≤∞‡≥ã‡≤ó‡≤®‡≤ø‡≤∞‡≥ç‡≤£‡≤Ø ‡≤µ‡≤∞‡≤¶‡≤ø'
            };
            const subtitleText = {
                en: 'A personalized analysis has been sent to your email',
                hi: '‡§è‡§ï ‡§µ‡•ç‡§Ø‡§ï‡•ç‡§§‡§ø‡§ó‡§§ ‡§µ‡§ø‡§∂‡•ç‡§≤‡•á‡§∑‡§£ ‡§Ü‡§™‡§ï‡•á ‡§à‡§Æ‡•á‡§≤ ‡§™‡§∞ ‡§≠‡•á‡§ú ‡§¶‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ ‡§π‡•à',
                kn: '‡≤µ‡≥à‡≤Ø‡≤ï‡≥ç‡≤§‡≥Ä‡≤ï‡≤∞‡≤ø‡≤∏‡≤ø‡≤¶ ‡≤µ‡≤ø‡≤∂‡≥ç‡≤≤‡≥á‡≤∑‡≤£‡≥Ü‡≤Ø‡≤®‡≥ç‡≤®‡≥Å ‡≤®‡≤ø‡≤Æ‡≥ç‡≤Æ ‡≤á‡≤Æ‡≥á‡≤≤‡≥ç‚Äå‡≤ó‡≥Ü ‡≤ï‡≤≥‡≥Å‡≤π‡≤ø‡≤∏‡≤≤‡≤æ‡≤ó‡≤ø‡≤¶‡≥Ü'
            };
            
            if (badge) badge.textContent = badgeText[currentLanguage] || badgeText.en;
            if (title) title.textContent = titleText[currentLanguage] || titleText.en;
            if (subtitle) subtitle.textContent = subtitleText[currentLanguage] || subtitleText.en;
            
            const container = document.getElementById('results-content');
            
            if (assessmentState.mode === 'coupon') {
                // Partner diagnostic - full report sent
                const emailConfirmText = {
                    en: `Full Diagnostic Report Sent to ${assessmentState.email}`,
                    hi: `‡§∏‡§Ç‡§™‡•Ç‡§∞‡•ç‡§£ ‡§®‡§ø‡§¶‡§æ‡§® ‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü ${assessmentState.email} ‡§ï‡•ã ‡§≠‡•á‡§ú‡•Ä ‡§ó‡§à`,
                    kn: `‡≤∏‡≤Ç‡≤™‡≥Ç‡≤∞‡≥ç‡≤£ ‡≤∞‡≥ã‡≤ó‡≤®‡≤ø‡≤∞‡≥ç‡≤£‡≤Ø ‡≤µ‡≤∞‡≤¶‡≤ø ${assessmentState.email} ‡≤ó‡≥Ü ‡≤ï‡≤≥‡≥Å‡≤π‡≤ø‡≤∏‡≤≤‡≤æ‡≤ó‡≤ø‡≤¶‡≥Ü`
                };
                const checkEmailText = {
                    en: `Check your email for the complete 35-page analysis (courtesy of ${partnerBranding ? partnerBranding.name : 'our partner'})`,
                    hi: `‡§∏‡§Ç‡§™‡•Ç‡§∞‡•ç‡§£ 35-‡§™‡•É‡§∑‡•ç‡§† ‡§µ‡§ø‡§∂‡•ç‡§≤‡•á‡§∑‡§£ ‡§ï‡•á ‡§≤‡§ø‡§è ‡§Ö‡§™‡§®‡§æ ‡§à‡§Æ‡•á‡§≤ ‡§ú‡§æ‡§Ç‡§ö‡•á‡§Ç (${partnerBranding ? partnerBranding.name : '‡§π‡§Æ‡§æ‡§∞‡•á ‡§∏‡§æ‡§ù‡•á‡§¶‡§æ‡§∞'} ‡§ï‡•á ‡§∏‡•å‡§ú‡§®‡•ç‡§Ø ‡§∏‡•á)`,
                    kn: `‡≤∏‡≤Ç‡≤™‡≥Ç‡≤∞‡≥ç‡≤£ 35-‡≤™‡≥Å‡≤ü‡≤¶ ‡≤µ‡≤ø‡≤∂‡≥ç‡≤≤‡≥á‡≤∑‡≤£‡≥Ü‡≤ó‡≤æ‡≤ó‡≤ø ‡≤®‡≤ø‡≤Æ‡≥ç‡≤Æ ‡≤á‡≤Æ‡≥á‡≤≤‡≥ç ‡≤™‡≤∞‡≤ø‡≤∂‡≥Ä‡≤≤‡≤ø‡≤∏‡≤ø (${partnerBranding ? partnerBranding.name : '‡≤®‡≤Æ‡≥ç‡≤Æ ‡≤™‡≤æ‡≤≤‡≥Å‡≤¶‡≤æ‡≤∞'}‡≤∞ ‡≤∏‡≥å‡≤ú‡≤®‡≥ç‡≤Ø‡≤¶‡≤ø‡≤Ç‡≤¶)`
                };
                
                container.innerHTML = `
                    <div style="background: #f0fdf4; border: 2px solid #10b981; padding: 25px; border-radius: 8px; margin-bottom: 30px;">
                        <p style="margin: 0; font-weight: 600; font-size: 1.1rem; color: #059669;">
                            ‚úì ${emailConfirmText[currentLanguage] || emailConfirmText.en}
                        </p>
                        <p style="margin: 10px 0 0 0; color: #059669;">
                            ${checkEmailText[currentLanguage] || checkEmailText.en}
                        </p>
                    </div>
                    ${result.analysis}
                `;
            } else {
                // Free diagnostic
                const summaryText = {
                    en: `Summary Report Sent to ${assessmentState.email}`,
                    hi: `‡§∏‡§æ‡§∞‡§æ‡§Ç‡§∂ ‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü ${assessmentState.email} ‡§ï‡•ã ‡§≠‡•á‡§ú‡•Ä ‡§ó‡§à`,
                    kn: `‡≤∏‡≤æ‡≤∞‡≤æ‡≤Ç‡≤∂ ‡≤µ‡≤∞‡≤¶‡≤ø ${assessmentState.email} ‡≤ó‡≥Ü ‡≤ï‡≤≥‡≥Å‡≤π‡≤ø‡≤∏‡≤≤‡≤æ‡≤ó‡≤ø‡≤¶‡≥Ü`
                };
                const upgradeTitle = {
                    en: 'Unlock Deeper Insights',
                    hi: '‡§ó‡§π‡§∞‡•Ä ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä ‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§ ‡§ï‡§∞‡•á‡§Ç',
                    kn: '‡≤Ü‡≤≥‡≤µ‡≤æ‡≤¶ ‡≤í‡≤≥‡≤®‡≥ã‡≤ü‡≤ó‡≤≥‡≤®‡≥ç‡≤®‡≥Å ‡≤Ö‡≤®‡≥ç‚Äå‡≤≤‡≤æ‡≤ï‡≥ç ‡≤Æ‡≤æ‡≤°‡≤ø'
                };
                const fullReportTitle = {
                    en: 'Full 35-Page Diagnostic Report',
                    hi: '‡§∏‡§Ç‡§™‡•Ç‡§∞‡•ç‡§£ 35-‡§™‡•É‡§∑‡•ç‡§† ‡§®‡§ø‡§¶‡§æ‡§® ‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü',
                    kn: '‡≤∏‡≤Ç‡≤™‡≥Ç‡≤∞‡≥ç‡≤£ 35-‡≤™‡≥Å‡≤ü‡≤¶ ‡≤∞‡≥ã‡≤ó‡≤®‡≤ø‡≤∞‡≥ç‡≤£‡≤Ø ‡≤µ‡≤∞‡≤¶‡≤ø'
                };
                const upgradeBtn = {
                    en: 'Upgrade to Full Report ‚Üí',
                    hi: '‡§™‡•Ç‡§∞‡•ç‡§£ ‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü ‡§Æ‡•á‡§Ç ‡§Ö‡§™‡§ó‡•ç‡§∞‡•á‡§° ‡§ï‡§∞‡•á‡§Ç ‚Üí',
                    kn: '‡≤∏‡≤Ç‡≤™‡≥Ç‡≤∞‡≥ç‡≤£ ‡≤µ‡≤∞‡≤¶‡≤ø‡≤ó‡≥Ü ‡≤Ö‡≤™‡≥ç‚Äå‡≤ó‡≥ç‡≤∞‡≥á‡≤°‡≥ç ‡≤Æ‡≤æ‡≤°‡≤ø ‚Üí'
                };
                
                container.innerHTML = `
                    <div style="background: #eff6ff; border-left: 4px solid var(--accent-navy); padding: 20px; margin-bottom: 30px;">
                        <p style="margin: 0; font-weight: 600; color: var(--accent-navy);">
                            ‚úì ${summaryText[currentLanguage] || summaryText.en}
                        </p>
                    </div>
                    
                    ${result.analysis}

                    <div style="margin-top: 50px;">
                        <h3 style="text-align: center; margin-bottom: 30px; color: var(--accent-navy);">
                            ${upgradeTitle[currentLanguage] || upgradeTitle.en}
                        </h3>
                        
                        <div class="card" style="border: 2px solid var(--accent-navy); padding: 30px; background: white;">
                            <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 20px;">
                                <div>
                                    <h4 style="margin: 0 0 10px 0; color: var(--accent-navy);">
                                        ${fullReportTitle[currentLanguage] || fullReportTitle.en}
                                    </h4>
                                    <p style="margin: 0; color: var(--text-muted); font-size: 0.95rem;">Complete 7-cylinder breakdown with 90-day roadmap</p>
                                </div>
                                <div style="text-align: right; white-space: nowrap; margin-left: 20px;">
                                    <div style="text-decoration: line-through; color: #999; font-size: 0.9rem;">‚Çπ29,997</div>
                                    <div style="font-weight: 700; color: var(--accent-navy); font-size: 1.4rem;">‚Çπ24,997</div>
                                </div>
                            </div>
                            
                            <ul style="margin: 20px 0 30px 0; padding-left: 20px; color: var(--text-primary);">
                                <li style="margin-bottom: 8px;">Root cause analysis (not just symptoms)</li>
                                <li style="margin-bottom: 8px;">Industry benchmarking & comparison</li>
                                <li style="margin-bottom: 8px;">90-day action roadmap</li>
                                <li style="margin-bottom: 8px;">Matched case studies</li>
                                <li>Build/buy/partner recommendations</li>
                            </ul>
                            
                            <button onclick="showPayment('institutional')" class="btn" style="width: 100%; padding: 16px; font-size: 1.05rem;">
                                ${upgradeBtn[currentLanguage] || upgradeBtn.en}
                            </button>
                        </div>
                    </div>
                `;
            }
        }

        function showPayment(type) {
            const rzp = new Razorpay({
                key: 'rzp_live_YOUR_ACTUAL_ID_HERE', // ‚ö†Ô∏è REPLACE WITH YOUR RAZORPAY KEY
                amount: 2499700,
                currency: 'INR',
                name: 'Kernorigin',
                description: 'Full Institutional Diagnostic',
                prefill: { 
                    name: assessmentState.name,
                    email: assessmentState.email 
                },
                theme: { color: '#002244' },
                handler: function(response) {
                    alert('Payment successful! Generating your full report...');
                    // TODO: Send payment details to backend for full report generation
                }
            });
            rzp.open();
        }
    </script>
</body>
</html>